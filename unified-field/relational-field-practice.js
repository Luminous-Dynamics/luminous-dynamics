/**
 * Relational Field Practice - Sacred Technology for Conscious Relationship
 * 
 * Transforms individual glyph practices into relational field cultivation.
 * Based on the field dynamics from the original mystical glyphs, these 
 * practices create shared coherence between beings.
 * 
 * "The field is more intelligent than any individual participant.
 *  When we practice together, something greater emerges."
 */

class RelationalFieldPractice {
    constructor() {
        this.relationalGlyphs = this.initializeRelationalGlyphs();
        this.fieldDynamics = this.initializeFieldDynamics();
        this.practiceConfigurations = this.initializePracticeConfigurations();
    }

    initializeRelationalGlyphs() {
        return {
            "Ω0": {
                id: "Ω0",
                name: "First Presence",
                mysticalDesignation: "The Shimmering Unnamed",
                
                relationalVersions: {
                    twoPersonPractice: {
                        name: "Mutual Arrival",
                        setup: "Sit facing each other at a comfortable distance",
                        
                        accessible: {
                            instructions: [
                                "Begin together with three conscious breaths",
                                "Make gentle eye contact without forcing it",
                                "Notice how it feels to arrive together",
                                "Rest in shared presence for 1-2 minutes",
                                "End by bowing to acknowledge the shared field"
                            ],
                            duration: "3-5 minutes",
                            intention: "Creating safety for both beings to be fully present"
                        },
                        
                        developing: {
                            instructions: [
                                "Begin with individual Ω0 practice simultaneously",
                                "Gradually include awareness of your partner's presence",
                                "Notice how your presence affects their settling",
                                "Find the rhythm of breathing that feels shared",
                                "Rest together in the field of mutual presence",
                                "Share one word about the quality of presence you experienced"
                            ],
                            duration: "5-10 minutes",
                            intention: "Discovering how presence is contagious and mutually supportive"
                        },
                        
                        mystical: {
                            instructions: [
                                "Enter the shimmer of pre-manifestation together",
                                "Feel the field of awareness that contains both of you",
                                "Rest in the recognition that presence is not personal",
                                "Allow the shared field to settle both nervous systems",
                                "Notice how the 'we-space' has its own intelligence",
                                "Emerge slowly, honoring what was co-created"
                            ],
                            duration: "10-20 minutes",
                            intention: "Recognizing consciousness as inherently relational",
                            fieldDynamic: "Creating a gravity well of shared calm that amplifies individual presence"
                        }
                    },
                    
                    groupPractice: {
                        name: "Collective Arrival",
                        setup: "Circle formation, comfortable spacing",
                        
                        accessible: {
                            instructions: [
                                "One person begins with a conscious breath",
                                "Let the breath 'travel' around the circle naturally",
                                "Each person adds their presence without rushing",
                                "Sit together in shared stillness for 2-3 minutes",
                                "Close with a moment of gratitude for the collective field"
                            ],
                            participants: "3-12 people",
                            duration: "5-8 minutes"
                        },
                        
                        developing: {
                            instructions: [
                                "Begin with silent individual arrival (2 minutes)",
                                "Gradually expand awareness to include the whole circle",
                                "Notice how the group's presence supports your own settling",
                                "Find the collective breathing rhythm without forcing",
                                "Rest in the field of group coherence",
                                "Share one-word check-ins about the group field quality"
                            ],
                            participants: "5-20 people",
                            duration: "10-15 minutes"
                        },
                        
                        mystical: {
                            instructions: [
                                "Create a unified field of pre-verbal presence",
                                "Feel individual boundaries softening while maintaining integrity",
                                "Rest in the collective shimmer of pure potential",
                                "Allow the group field to become a teacher",
                                "Notice how collective presence has its own wisdom",
                                "Harvest insights about the nature of shared consciousness"
                            ],
                            participants: "7-30 people",
                            duration: "15-30 minutes",
                            fieldDynamic: "Group coherence that exceeds the sum of individual presence"
                        }
                    },
                    
                    familyPractice: {
                        name: "Sacred Family Arrival",
                        setup: "Adapted for families with children",
                        
                        accessible: {
                            instructions: [
                                "Gather in living room or comfortable space",
                                "Each person takes 'three magic breaths' together",
                                "Share one thing you're grateful for about being together",
                                "Sit quietly for 30 seconds (longer for older kids)",
                                "End with family hug or high-fives"
                            ],
                            ages: "All ages (adapted for attention spans)",
                            duration: "2-5 minutes",
                            benefits: "Creates family coherence and reduces reactivity"
                        },
                        
                        developing: {
                            instructions: [
                                "Begin with individual settling (adapted by age)",
                                "Share how each person is feeling in their body",
                                "Practice 'feeling the whole family' together",
                                "Rest in family connection without talking",
                                "Share appreciations for each family member"
                            ],
                            ages: "6+ years with guidance",
                            duration: "5-10 minutes",
                            benefits: "Builds emotional intelligence and family attunement"
                        }
                    }
                },
                
                relationalMarkers: {
                    twoPersonSuccess: [
                        "Both people feel more settled than they did alone",
                        "Natural synchronization of breathing or movement",
                        "Sense of safety and non-judgment in shared space",
                        "Feeling held by something larger than individual effort"
                    ],
                    groupSuccess: [
                        "Palpable shift in room energy toward calm",
                        "Natural quieting of mental chatter",
                        "Increased eye contact and open body language",
                        "Sense of collective resource and support"
                    ],
                    familySuccess: [
                        "Reduced reactivity in family interactions",
                        "Children naturally becoming calmer",
                        "Increased affection and cooperation",
                        "Family conflicts resolving more easily"
                    ]
                }
            },

            "Ω1": {
                id: "Ω1", 
                name: "Conscious Arrival",
                mysticalDesignation: "The Sacred Threshold",
                
                relationalVersions: {
                    twoPersonPractice: {
                        name: "Mutual Intention Setting",
                        setup: "Sitting or standing facing each other",
                        
                        accessible: {
                            instructions: [
                                "Begin with mutual Ω0 (First Presence) practice",
                                "Share: 'How do I want to show up for you today?'",
                                "Listen to your partner's intention without responding",
                                "Reflect back what you heard in their heart",
                                "Set a shared intention for your time together",
                                "Proceed with this mutual intention guiding you"
                            ],
                            duration: "5-8 minutes",
                            intention: "Creating conscious relationship rather than unconscious interaction"
                        },
                        
                        developing: {
                            instructions: [
                                "Practice individual threshold awareness together",
                                "Share what qualities each person wants to bring",
                                "Notice how your partner's intention affects your own",
                                "Co-create an intention that serves both beings",
                                "Feel how shared intention changes the relational field",
                                "Check in throughout interaction: 'Are we living our intention?'"
                            ],
                            duration: "8-12 minutes",
                            intention: "Discovering how conscious intention creates relational coherence"
                        },
                        
                        mystical: {
                            instructions: [
                                "Honor the sacred threshold of meeting another being",
                                "Feel the significance of two consciousnesses choosing to connect",
                                "Allow shared intention to emerge from the field between you",
                                "Recognize the relationship itself as a third intelligence",
                                "Proceed as servants of the conscious relationship",
                                "Let the relationship's intention guide individual choices"
                            ],
                            duration: "10-15 minutes",
                            fieldDynamic: "Relationship as conscious entity with its own wisdom and purpose"
                        }
                    },
                    
                    groupPractice: {
                        name: "Collective Intention Weaving",
                        setup: "Circle formation with clear center",
                        
                        accessible: {
                            instructions: [
                                "Begin with group Ω0 (Collective Arrival)",
                                "Each person shares one word for how they want to show up",
                                "Place intention words in center (physically or energetically)",
                                "Find the common thread connecting all intentions",
                                "Name the group's shared intention together",
                                "Begin meeting/gathering with this intention as guide"
                            ],
                            participants: "3-15 people",
                            duration: "8-12 minutes"
                        },
                        
                        developing: {
                            instructions: [
                                "Individual intention setting with group awareness",
                                "Share intentions in pairs, then synthesize with whole group",
                                "Notice how individual intentions can serve the collective",
                                "Co-create group intention that honors all participants",
                                "Feel how shared intention transforms group dynamics",
                                "Return to group intention when discussions get scattered"
                            ],
                            participants: "5-25 people", 
                            duration: "12-20 minutes"
                        },
                        
                        mystical: {
                            instructions: [
                                "Recognize the group as a collective consciousness crossing a threshold",
                                "Feel the significance of multiple beings choosing conscious collaboration",
                                "Allow the group's purpose to emerge from the collective field",
                                "Serve the group's highest intention rather than individual agendas",
                                "Let group wisdom guide decision-making processes",
                                "Honor the group as a teacher and evolutionary force"
                            ],
                            participants: "7-50 people",
                            duration: "15-30 minutes",
                            fieldDynamic: "Group consciousness as emergent intelligence"
                        }
                    },
                    
                    workplacePractice: {
                        name: "Conscious Team Alignment",
                        setup: "Meeting room or virtual space",
                        
                        accessible: {
                            instructions: [
                                "Begin meetings with 30 seconds of shared breathing",
                                "Each person shares their intention for the meeting in one sentence",
                                "Identify the common purpose connecting everyone",
                                "Agree on how the team wants to collaborate",
                                "Return to team intention when discussions become reactive"
                            ],
                            duration: "3-5 minutes",
                            benefits: "Reduces meeting reactivity and increases productivity"
                        },
                        
                        developing: {
                            instructions: [
                                "Practice conscious arrival at beginning of workday/meetings",
                                "Share individual intentions and synthesize into team purpose",
                                "Check in on team energy and intention throughout projects",
                                "Use challenges as opportunities to return to conscious collaboration",
                                "End meetings by appreciating the quality of presence created"
                            ],
                            duration: "5-10 minutes",
                            benefits: "Creates psychological safety and innovative thinking"
                        }
                    }
                }
            },

            "Ω4": {
                id: "Ω4",
                name: "Sacred Listening", 
                mysticalDesignation: "The Resonant Heart",
                
                relationalVersions: {
                    twoPersonPractice: {
                        name: "Mutual Sacred Witnessing",
                        setup: "Comfortable seating, facing each other",
                        
                        accessible: {
                            instructions: [
                                "Begin with mutual Ω0 to arrive together",
                                "Person A speaks for 3 minutes while B practices sacred listening",
                                "B reflects back what they heard in A's heart (not advice)",
                                "Switch roles - B speaks for 3 minutes, A listens",
                                "A reflects back what they heard in B's heart",
                                "Share appreciation for the quality of listening received"
                            ],
                            duration: "10-12 minutes",
                            prompts: ["What's alive in me right now?", "What am I learning about myself?", "What do I need to feel heard about?"]
                        },
                        
                        developing: {
                            instructions: [
                                "Enter the practice as servants of truth emergence",
                                "Speaker: Share from your deepest authentic place",
                                "Listener: Become a spacious mirror reflecting their essence",
                                "Notice how quality of listening affects what becomes sayable",
                                "Reflect back the wisdom you heard trying to emerge",
                                "Switch roles with same depth of sacred attention",
                                "Harvest insights about the power of being truly witnessed"
                            ],
                            duration: "15-20 minutes",
                            deeperPrompts: ["What wants to be known about my journey?", "Where am I growing an edge?", "What is my heart asking for?"]
                        },
                        
                        mystical: {
                            instructions: [
                                "Become a sacred vessel for the other's truth",
                                "Listen from the field of unconditional love",
                                "Feel how the speaker's deepest wisdom wants to emerge",
                                "Reflect back the gold you hear hidden in their words", 
                                "Allow the conversation to become a mutual healing",
                                "Recognize the sacred dimension of being witnessed",
                                "Honor how true listening becomes a form of love in action"
                            ],
                            duration: "20-30 minutes",
                            fieldDynamic: "Mutual witnessing that heals and transforms both beings",
                            soulPrompts: ["What is my soul asking me to know?", "How is life trying to evolve through me?", "What wants to be born through my relationships?"]
                        }
                    },
                    
                    groupPractice: {
                        name: "Council of Sacred Voices",
                        setup: "Circle with talking piece (stone, feather, etc.)",
                        
                        accessible: {
                            instructions: [
                                "Begin with group Ω0 to create container",
                                "Pass talking piece clockwise",
                                "Whoever holds piece speaks from heart (2-3 minutes max)",
                                "Everyone else practices sacred listening without response",
                                "No advice, questions, or immediate responses",
                                "Complete circle ends with moment of appreciation for all voices"
                            ],
                            participants: "4-12 people",
                            duration: "20-40 minutes depending on group size"
                        },
                        
                        developing: {
                            instructions: [
                                "Create sacred container through group intention",
                                "Speaking prompt: 'What wants to be witnessed by this circle?'",
                                "Speak only when genuinely moved to share", 
                                "Listen for the wisdom trying to emerge through each person",
                                "Notice how group listening affects quality of sharing",
                                "Optional second round: reflections on themes heard",
                                "Close by appreciating the collective wisdom shared"
                            ],
                            participants: "6-20 people",
                            duration: "30-60 minutes"
                        },
                        
                        mystical: {
                            instructions: [
                                "Create sacred council container honoring ancient wisdom traditions",
                                "Invoke the group's highest intention for truth-telling",
                                "Speak only what serves the collective healing and awakening",
                                "Listen for how individual stories serve universal themes",
                                "Allow the group field to become a teacher about human nature",
                                "Harvest collective wisdom that emerged through individual voices",
                                "Honor how sacred listening creates community healing"
                            ],
                            participants: "8-30 people",
                            duration: "45-90 minutes",
                            fieldDynamic: "Collective witnessing that reveals universal wisdom through personal truth"
                        }
                    },
                    
                    conflictTransformation: {
                        name: "Sacred Listening in Difficult Conversations",
                        setup: "Neutral space, clear agreements",
                        
                        accessible: {
                            instructions: [
                                "Begin with mutual Ω0 to settle nervous systems",
                                "Agree: 'We commit to hearing each other's hearts'",
                                "Person A shares their experience for 5 minutes uninterrupted",
                                "Person B reflects back what they heard (feelings, needs, not content)",
                                "Switch - B shares their experience for 5 minutes",
                                "A reflects back what they heard in B's heart",
                                "Find one thing you can both appreciate about this process"
                            ],
                            duration: "15-20 minutes",
                            intention: "Creating safety for vulnerable truth in conflict"
                        },
                        
                        developing: {
                            instructions: [
                                "Enter conflict as opportunity for deeper mutual understanding",
                                "Commit to hearing the pain and need beneath positions",
                                "Practice listening for how you may have contributed to the rupture",
                                "Reflect back the valid concerns you hear in their perspective",
                                "Share your own experience without blame or defense",
                                "Look for the gifts this conflict might be offering",
                                "Find ways to honor both people's needs going forward"
                            ],
                            duration: "20-40 minutes",
                            intention: "Transforming conflict into mutual growth and understanding"
                        }
                    }
                }
            }
        };
    }

    initializeFieldDynamics() {
        return {
            // Core principles of relational field practice
            foundationalPrinciples: {
                fieldIntelligence: "The relational field has wisdom beyond individual participants",
                mutualBenefit: "Practices should serve all beings involved, not just one person",
                emergentProperties: "Group practice creates qualities that don't exist in individual practice",
                safetyFirst: "Psychological and emotional safety is prerequisite for deeper practice",
                voluntaryParticipation: "All relational practice must be freely chosen by all participants"
            },
            
            // How individual glyphs transform in relational context
            relationalTransformation: {
                fromIndividual: "Focus on personal transformation and skill building",
                toRelational: "Focus on mutual transformation and shared field cultivation",
                emergentQualities: "Compassion, attunement, collective wisdom, shared resilience"
            },
            
            // Safety protocols for relational practice
            safetyProtocols: {
                consent: "Clear agreements about participation level and boundaries",
                optOut: "Anyone can pause or withdraw from practice at any time",
                confidentiality: "What's shared in practice stays in the container",
                nonAdvice: "Reflecting and witnessing, not fixing or advising",
                trauma: "Recognition that some practices may activate past wounds"
            }
        };
    }

    initializePracticeConfigurations() {
        return {
            // Different relationship contexts and their needs
            contextualAdaptations: {
                romanticPartners: {
                    focus: "Deepening intimacy and understanding",
                    considerations: "Power dynamics, sexual energy, long-term patterns",
                    adaptations: "Shorter sessions, more frequent practice, conflict-specific versions"
                },
                
                friendships: {
                    focus: "Mutual support and authentic connection",
                    considerations: "Varying comfort levels, time constraints, social dynamics",
                    adaptations: "Flexible timing, optional sharing levels, low-pressure environment"
                },
                
                familyRelationships: {
                    focus: "Healing generational patterns and creating conscious family culture",
                    considerations: "Age differences, family roles, historical dynamics",
                    adaptations: "Age-appropriate versions, shorter attention spans, honoring family structure"
                },
                
                workplaceTeams: {
                    focus: "Conscious collaboration and psychological safety",
                    considerations: "Professional boundaries, hierarchy, productivity focus",
                    adaptations: "Time-efficient, results-oriented, optional spiritual language"
                },
                
                communityGroups: {
                    focus: "Collective wisdom and social coherence",
                    considerations: "Diverse backgrounds, varying comfort with intimacy, group dynamics",
                    adaptations: "Inclusive language, multiple entry points, clear facilitation"
                }
            }
        };
    }

    // Public API for integrating relational practices
    getRelationalPractice(glyphId, practiceType, depthLevel = 'accessible') {
        const glyph = this.relationalGlyphs[glyphId];
        if (!glyph || !glyph.relationalVersions[practiceType]) return null;
        
        const practice = glyph.relationalVersions[practiceType];
        return {
            name: practice.name,
            setup: practice.setup,
            practice: practice[depthLevel],
            markers: glyph.relationalMarkers,
            safetyGuidelines: this.fieldDynamics.safetyProtocols
        };
    }

    adaptPracticeForContext(glyphId, practiceType, context, participants) {
        const basePractice = this.getRelationalPractice(glyphId, practiceType);
        if (!basePractice) return null;
        
        const contextAdaptation = this.practiceConfigurations.contextualAdaptations[context];
        
        return {
            ...basePractice,
            contextualFocus: contextAdaptation?.focus,
            adaptations: contextAdaptation?.adaptations,
            participantCount: participants,
            estimatedDuration: this.calculateDuration(practiceType, participants)
        };
    }

    calculateDuration(practiceType, participantCount) {
        const baseDurations = {
            twoPersonPractice: { min: 5, max: 30 },
            groupPractice: { min: 10, max: 60 },
            familyPractice: { min: 2, max: 15 },
            workplacePractice: { min: 3, max: 15 }
        };
        
        const base = baseDurations[practiceType] || { min: 5, max: 20 };
        
        if (practiceType === 'groupPractice') {
            // Group practices scale with participant count
            const timePerPerson = 2; // minutes
            return {
                estimated: Math.min(base.min + (participantCount * timePerPerson), base.max),
                range: `${base.min}-${base.max} minutes`
            };
        }
        
        return { estimated: base.min + 5, range: `${base.min}-${base.max} minutes` };
    }
}

// Export for global use
if (typeof window !== 'undefined') {
    window.RelationalFieldPractice = RelationalFieldPractice;
}

if (typeof module !== 'undefined' && module.exports) {
    module.exports = RelationalFieldPractice;
}