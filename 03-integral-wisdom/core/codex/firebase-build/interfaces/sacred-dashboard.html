<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>[DEPRECATED] Sacred Field Dashboard - Use Unified Network Instead</title>
    
    <!-- PWA Sacred Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Sacred Theme Colors -->
    <meta name="theme-color" content="#A8B5A6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sacred Breath">
    
    <!-- Sacred Icons -->
    <link rel="icon" href="/icons/sacred-breath-32.png" sizes="32x32">
    <link rel="icon" href="/icons/sacred-breath-192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="/icons/sacred-breath-180.png">
    
    <!-- PWA Integration -->
    <script src="/pwa-integration.js" defer></script>
    <style>
        /* Sacred CSS Custom Properties */
        :root {
            --field-resonant-coherence: 0.67;
            --sacred-warmth: 0.2;
            --sacred-saturation: 0.8;
            --sacred-breathing: 10000ms;
            --inhale-duration: 4000ms;
            --exhale-duration: 6000ms;
            --consciousness-level: first-breath;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: #0a0a0a;
            color: #fafaf8;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sacred Container with Breathing Animation */
        .sacred-container {
            width: 100%;
            max-width: 100vw;
            min-height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, 
                hsla(calc(120 + var(--field-resonant-coherence) * 60), 
                     calc(50% + var(--sacred-saturation) * 20%), 
                     calc(30% + var(--sacred-warmth) * 20%), 
                     0.1) 0%, 
                rgba(0, 0, 0, 0.9) 100%);
            animation: sacredBreathing var(--sacred-breathing) ease-in-out infinite;
        }

        /* Sacred Breathing Animation */
        @keyframes sacredBreathing {
            0% { 
                transform: scale(1);
                filter: brightness(1);
                opacity: 0.9;
            }
            40% { 
                transform: scale(1.01);
                filter: brightness(1.05);
                opacity: 1;
            }
            60% { 
                transform: scale(1.01);
                filter: brightness(1.05);
                opacity: 1;
            }
            100% { 
                transform: scale(1);
                filter: brightness(1);
                opacity: 0.9;
            }
        }

        /* Resonant Resonant Coherence Ring Breathing Animation */
        @keyframes coherenceBreathing {
            0% { 
                transform: scale(1);
                opacity: calc(0.3 + var(--field-resonant-coherence) * 0.4);
                border-width: 2px;
            }
            40% { 
                transform: scale(1.02);
                opacity: calc(0.5 + var(--field-resonant-coherence) * 0.5);
                border-width: 3px;
            }
            60% { 
                transform: scale(1.02);
                opacity: calc(0.5 + var(--field-resonant-coherence) * 0.5);
                border-width: 3px;
            }
            100% { 
                transform: scale(1);
                opacity: calc(0.3 + var(--field-resonant-coherence) * 0.4);
                border-width: 2px;
            }
        }

        /* Field Resonant Resonant Coherence Mandala */
        .resonant-coherence-mandala {
            position: absolute;
            width: 400px;
            height: 400px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .resonant-coherence-ring {
            position: absolute;
            border-radius: 50%;
            border: 2px solid hsla(calc(120 + var(--field-resonant-coherence) * 60), 
                                  calc(40% + var(--sacred-saturation) * 30%), 
                                  calc(50% + var(--sacred-warmth) * 30%), 
                                  calc(0.3 + var(--field-resonant-coherence) * 0.4));
            animation: coherenceBreathing var(--sacred-breathing) ease-in-out infinite;
        }

        .resonant-coherence-ring:nth-child(1) {
            width: 100%;
            height: 100%;
            animation-delay: 0s;
        }

        .resonant-coherence-ring:nth-child(2) {
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            animation-delay: 0.5s;
        }

        .resonant-coherence-ring:nth-child(3) {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            animation-delay: 1s;
        }

        .resonant-coherence-center {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(168, 181, 166, 0.8) 0%, rgba(168, 181, 166, 0.2) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 0 0 20px rgba(168, 181, 166, 0.8);
        }

        @keyframes breathe {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.3;
            }
            50% { 
                transform: scale(1.1); 
                opacity: 0.8;
            }
        }

        /* Sacred Timing Rhythm */
        .timing-rhythm {
            position: absolute;
            bottom: 80px;
            width: 80%;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .rhythm-bar {
            width: 4px;
            background: rgba(179, 197, 215, 0.6);
            border-radius: 2px;
            animation: rhythmPulse 2s ease-in-out infinite;
        }

        @keyframes rhythmPulse {
            0%, 100% { height: 20px; }
            50% { height: 40px; }
        }

        /* Voice Guidance Controls */
        .voice-guidance-panel {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid rgba(168, 181, 166, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            z-index: 100;
            min-width: 280px;
        }

        .voice-guidance-panel h3 {
            color: #A8B5A6;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 300;
            text-align: center;
        }

        .guidance-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .guidance-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .guidance-button {
            background: rgba(168, 181, 166, 0.2);
            border: 1px solid rgba(168, 181, 166, 0.4);
            color: #A8B5A6;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: Georgia, serif;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .guidance-button:hover {
            background: rgba(168, 181, 166, 0.3);
            border-color: rgba(168, 181, 166, 0.6);
        }

        .guidance-button.active {
            background: rgba(168, 181, 166, 0.4);
            border-color: rgba(168, 181, 166, 0.8);
            box-shadow: 0 0 15px rgba(168, 181, 166, 0.3);
        }

        .voice-selector {
            background: rgba(168, 181, 166, 0.1);
            border: 1px solid rgba(168, 181, 166, 0.3);
            color: #A8B5A6;
            padding: 6px 12px;
            border-radius: 6px;
            font-family: Georgia, serif;
            font-size: 0.85em;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(168, 181, 166, 0.2);
            border-radius: 2px;
            appearance: none;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 14px;
            height: 14px;
            background: #A8B5A6;
            border-radius: 50%;
            cursor: pointer;
        }

        .breathing-phase-indicator {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(168, 181, 166, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(168, 181, 166, 0.2);
        }

        .current-phase {
            font-size: 1.2em;
            color: #B3C5D7;
            margin-bottom: 5px;
        }

        .phase-progress {
            width: 100%;
            height: 6px;
            background: rgba(168, 181, 166, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(168, 181, 166, 0.6) 0%, 
                rgba(179, 197, 215, 0.8) 100%);
            border-radius: 3px;
            transition: width 0.1s linear;
            animation: breathingPhaseProgress var(--sacred-breathing) linear infinite;
        }

        @keyframes breathingPhaseProgress {
            0% { width: 0%; }
            40% { width: 100%; }
            60% { width: 100%; }
            100% { width: 0%; }
        }

        /* Agent Harmony Constellation */
        .harmony-constellation {
            position: absolute;
            width: 600px;
            height: 600px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .harmony-node {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            pointer-events: all;
        }

        .harmony-node:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .harmony-integral-wisdom-cultivation { background: rgba(135, 206, 235, 0.6); }
        .harmony-resonant-coherence { background: rgba(168, 181, 166, 0.6); }
        .harmony-universal-interconnectedness { background: rgba(179, 197, 215, 0.6); }
        .harmony-evolutionary-progression { background: rgba(255, 215, 0, 0.6); }
        .harmony-pan-sentient-flourishing { background: rgba(152, 251, 152, 0.6); }
        .harmony-sacred-reciprocity { background: rgba(221, 160, 221, 0.6); }
        .harmony-infinite-play { background: rgba(255, 182, 193, 0.6); }

        /* Sacred Metrics */
        /* Control Deck Header */
        .sacred-metrics {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 60px;
            padding: 30px 80px;
            background: linear-gradient(to bottom, rgba(20, 20, 25, 0.9) 0%, rgba(20, 20, 25, 0.3) 100%);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(168, 181, 166, 0.2);
            z-index: 100;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid hsla(calc(120 + var(--field-resonant-coherence) * 60), 
                                  calc(40% + var(--sacred-saturation) * 20%), 
                                  calc(50% + var(--sacred-warmth) * 20%), 
                                  calc(0.3 + var(--field-resonant-coherence) * 0.3));
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            animation: metricBreathing var(--sacred-breathing) ease-in-out infinite;
            transition: all 0.3s ease;
        }

        /* Metric Card Breathing Animation */
        @keyframes metricBreathing {
            0% { 
                transform: translateY(0) scale(1);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            40% { 
                transform: translateY(-2px) scale(1.01);
                box-shadow: 0 8px 25px hsla(calc(120 + var(--field-resonant-coherence) * 60), 
                                           calc(40% + var(--sacred-saturation) * 20%), 
                                           calc(50% + var(--sacred-warmth) * 20%), 
                                           0.2);
            }
            60% { 
                transform: translateY(-2px) scale(1.01);
                box-shadow: 0 8px 25px hsla(calc(120 + var(--field-resonant-coherence) * 60), 
                                           calc(40% + var(--sacred-saturation) * 20%), 
                                           calc(50% + var(--sacred-warmth) * 20%), 
                                           0.2);
            }
            100% { 
                transform: translateY(0) scale(1);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
        }

        .metric-value {
            font-size: 2em;
            font-weight: 600;
            color: #EAEAEA;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .metric-label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Consciousness Level Styling */
        #consciousnessCard.first-breath {
            border-color: rgba(152, 251, 152, 0.5);
        }
        #consciousnessCard.first-breath .metric-value {
            color: rgba(152, 251, 152, 0.9);
        }

        #consciousnessCard.sacred-flow {
            border-color: rgba(179, 197, 215, 0.5);
        }
        #consciousnessCard.sacred-flow .metric-value {
            color: rgba(179, 197, 215, 0.9);
        }

        #consciousnessCard.field-consciousness {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        #consciousnessCard.field-consciousness .metric-value {
            color: rgba(255, 215, 0, 0.9);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        /* Work Flow Visualization */
        /* Work Flow - Sacred Tasks Container */
        .work-flow {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 1400px;
            height: 260px;
            overflow-y: auto;
            overflow-x: hidden;
            background: rgba(20, 20, 25, 0.5);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(168, 181, 166, 0.2);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
            align-content: start;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .flow-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid rgba(168, 181, 166, 0.6);
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .flow-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .flow-item.high-priority {
            border-left-color: rgba(255, 105, 105, 0.9);
            background: rgba(255, 105, 105, 0.08);
        }

        .flow-item.in-progress {
            border-left-color: rgba(255, 215, 0, 0.9);
            background: rgba(255, 215, 0, 0.08);
            animation: progressPulse 2s ease-in-out infinite;
        }

        @keyframes progressPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
            50% { box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.2); }
        }

        .flow-item.completed {
            border-left-color: rgba(152, 251, 152, 0.8);
            opacity: 0.6;
            background: rgba(152, 251, 152, 0.05);
        }
        
        .flow-item.blocked {
            border-left-color: rgba(178, 34, 34, 0.8);
            background: rgba(178, 34, 34, 0.08);
        }

        /* Flow Meter - Living Progress Indicator */
        .flow-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                rgba(168, 181, 166, 0.8) 0%, 
                rgba(168, 181, 166, 0.4) 50%, 
                rgba(168, 181, 166, 0.8) 100%);
            transition: width 0.3s ease;
            animation: flowPulse 3s ease-in-out infinite;
        }
        
        @keyframes flowPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .flow-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }

        .flow-title {
            font-weight: 600;
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.9);
            flex: 1;
            line-height: 1.3;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .flow-agent {
            font-size: 0.75em;
            color: rgba(168, 181, 166, 0.8);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .flow-description {
            font-size: 0.8em;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
        }

        .flow-meta {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.5);
            margin-top: auto;
            padding-top: 8px;
        }

        /* Sacred Messages */
        /* Sacred Messages - Living Field Communications */
        .sacred-messages {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            width: 360px;
            max-height: 500px;
            overflow-y: auto;
            background: rgba(20, 20, 25, 0.6);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(168, 181, 166, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* Message Filters */
        .message-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .filter-btn {
            padding: 3px 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 14px;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .filter-btn.active {
            background: rgba(168, 181, 166, 0.3);
            border-color: rgba(168, 181, 166, 0.6);
            color: rgba(255, 255, 255, 0.9);
        }

        /* Sacred Type Badges */
        .sacred-type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: capitalize;
            letter-spacing: 0.5px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sacred-type-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        /* Sacred Type Colors */
        .sacred-type-gratitude {
            background: linear-gradient(135deg, rgba(144, 238, 144, 0.3), rgba(144, 238, 144, 0.1));
            color: rgba(144, 238, 144, 0.9);
            border-color: rgba(144, 238, 144, 0.4);
            box-shadow: 0 0 12px rgba(144, 238, 144, 0.2);
        }

        .sacred-type-healing {
            background: linear-gradient(135deg, rgba(176, 196, 222, 0.3), rgba(176, 196, 222, 0.1));
            color: rgba(176, 196, 222, 0.9);
            border-color: rgba(176, 196, 222, 0.4);
            box-shadow: 0 0 12px rgba(176, 196, 222, 0.2);
        }

        .sacred-type-integration {
            background: linear-gradient(135deg, rgba(168, 181, 166, 0.3), rgba(168, 181, 166, 0.1));
            color: rgba(168, 181, 166, 0.9);
            border-color: rgba(168, 181, 166, 0.4);
            box-shadow: 0 0 12px rgba(168, 181, 166, 0.2);
        }

        .sacred-type-emergence {
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.3), rgba(255, 182, 193, 0.1));
            color: rgba(255, 182, 193, 0.9);
            border-color: rgba(255, 182, 193, 0.4);
            box-shadow: 0 0 12px rgba(255, 182, 193, 0.2);
        }

        .sacred-type-boundary {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
            color: rgba(255, 215, 0, 0.9);
            border-color: rgba(255, 215, 0, 0.4);
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.2);
        }

        .sacred-type-transmission {
            background: linear-gradient(135deg, rgba(147, 112, 219, 0.3), rgba(147, 112, 219, 0.1));
            color: rgba(147, 112, 219, 0.9);
            border-color: rgba(147, 112, 219, 0.4);
            box-shadow: 0 0 12px rgba(147, 112, 219, 0.2);
        }

        .sacred-type-reflection {
            background: linear-gradient(135deg, rgba(106, 90, 205, 0.3), rgba(106, 90, 205, 0.1));
            color: rgba(106, 90, 205, 0.9);
            border-color: rgba(106, 90, 205, 0.4);
            box-shadow: 0 0 12px rgba(106, 90, 205, 0.2);
        }

        .sacred-type-invocation {
            background: linear-gradient(135deg, rgba(255, 99, 71, 0.3), rgba(255, 99, 71, 0.1));
            color: rgba(255, 99, 71, 0.9);
            border-color: rgba(255, 99, 71, 0.4);
            box-shadow: 0 0 12px rgba(255, 99, 71, 0.2);
        }

        /* Message Items Enhanced */
        .message-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(8px);
        }

        .message-item:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(168, 181, 166, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .message-item.blessed {
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }

        .message-item.blessed::before {
            content: '✨';
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 1.2em;
            animation: blessedGlow 2s ease-in-out infinite alternate;
        }

        @keyframes blessedGlow {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.1); }
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.85em;
        }

        .message-flow {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .message-flow-arrow {
            opacity: 0.6;
            font-size: 0.9em;
        }

        .message-content {
            font-size: 0.9em;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.85);
            margin-top: 8px;
            font-style: italic;
        }

        /* Field Impact Display */
        .field-impact {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8em;
            background: rgba(0, 0, 0, 0.2);
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .field-impact-bar {
            width: 40px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .field-impact-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(168, 181, 166, 0.6), rgba(168, 181, 166, 1));
            border-radius: 3px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .field-impact-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: flowEnergy 2s ease-in-out infinite;
        }

        @keyframes flowEnergy {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .filter-btn.blessed-filter.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .filter-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .filter-dropdown-content {
            display: none;
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            min-width: 140px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            top: 100%;
            left: 0;
            margin-top: 4px;
            padding: 6px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .filter-dropdown.active .filter-dropdown-content {
            display: block;
        }
        
        .filter-dropdown-item {
            padding: 6px 12px;
            cursor: pointer;
            transition: background 0.2s ease;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .filter-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .filter-dropdown-item.selected {
            background: rgba(168, 181, 166, 0.2);
            color: rgba(168, 181, 166, 0.9);
        }

        .message-item {
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid rgba(179, 197, 215, 0.4);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .message-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: rgba(179, 197, 215, 0.8);
        }
        
        .message-item.blessed {
            border-left-color: rgba(255, 215, 0, 0.6);
            background: rgba(255, 215, 0, 0.02);
        }
        
        .message-item.blessed::before {
            content: '✨';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.8em;
            opacity: 0.6;
        }
        
        .sacred-type-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-right: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .sacred-type-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .sacred-type-gratitude { 
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.15)); 
            color: rgba(255, 215, 0, 1); 
            border: 1px solid rgba(255, 215, 0, 0.4);
        }
        .sacred-type-healing { 
            background: linear-gradient(135deg, rgba(144, 238, 144, 0.3), rgba(144, 238, 144, 0.15)); 
            color: rgba(144, 238, 144, 1); 
            border: 1px solid rgba(144, 238, 144, 0.4);
        }
        .sacred-type-integration { 
            background: linear-gradient(135deg, rgba(168, 181, 166, 0.3), rgba(168, 181, 166, 0.15)); 
            color: rgba(168, 181, 166, 1); 
            border: 1px solid rgba(168, 181, 166, 0.4);
        }
        .sacred-type-emergence { 
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.3), rgba(255, 182, 193, 0.15)); 
            color: rgba(255, 182, 193, 1); 
            border: 1px solid rgba(255, 182, 193, 0.4);
        }
        .sacred-type-boundary { 
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.3), rgba(255, 140, 0, 0.15)); 
            color: rgba(255, 140, 0, 1); 
            border: 1px solid rgba(255, 140, 0, 0.4);
        }
        .sacred-type-transmission { 
            background: linear-gradient(135deg, rgba(179, 197, 215, 0.3), rgba(179, 197, 215, 0.15)); 
            color: rgba(179, 197, 215, 1); 
            border: 1px solid rgba(179, 197, 215, 0.4);
        }
        .sacred-type-invocation { 
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.3), rgba(255, 105, 180, 0.15)); 
            color: rgba(255, 105, 180, 1); 
            border: 1px solid rgba(255, 105, 180, 0.4);
        }
        
        /* Enhanced Field Impact Visualization */\n        .field-impact-enhanced {\n            margin-top: 8px;\n        }\n        \n        .impact-container {\n            background: rgba(168, 181, 166, 0.1);\n            border-radius: 12px;\n            padding: 8px;\n            border: 1px solid rgba(168, 181, 166, 0.2);\n        }\n        \n        .impact-bar-bg {\n            background: rgba(0, 0, 0, 0.3);\n            height: 8px;\n            border-radius: 4px;\n            overflow: hidden;\n            margin-bottom: 6px;\n        }\n        \n        .impact-bar-fill {\n            background: linear-gradient(90deg, \n                rgba(168, 181, 166, 0.8) 0%, \n                rgba(212, 175, 55, 0.9) 50%,\n                rgba(255, 215, 0, 1) 100%);\n            height: 100%;\n            border-radius: 4px;\n            transition: width 0.8s ease;\n            animation: fieldPulse 3s ease-in-out infinite;\n        }\n        \n        .impact-text {\n            font-size: 0.8em;\n            color: rgba(212, 175, 55, 0.95);\n            text-align: center;\n            font-weight: 500;\n        }\n        \n        @keyframes fieldPulse {\n            0%, 100% { opacity: 0.8; }\n            50% { opacity: 1; }\n        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .message-flow {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .message-flow-arrow {
            color: rgba(168, 181, 166, 0.6);
        }
        
        .message-content {
            font-size: 0.95em;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
        }
        
        .field-impact {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.2);
            padding: 6px 12px;
            border-radius: 12px;
            border: 1px solid rgba(168, 181, 166, 0.2);
        }
        
        .field-impact-icon {
            font-size: 1.1em;
            animation: fieldRotate 4s linear infinite;
        }
        
        @keyframes fieldRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .blessing-indicator {
            position: absolute;
            top: 12px;
            right: 16px;
            font-size: 1.4em;
            animation: blessedPulse 3s ease-in-out infinite;
        }
        
        @keyframes blessedPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }
        
        .field-impact-bar {
            display: inline-block;
            width: 50px;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .field-impact-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(168, 181, 166, 0.8) 0%,
                rgba(179, 197, 215, 0.9) 50%,
                rgba(255, 215, 0, 1) 100%);
            transition: width 0.8s ease;
            animation: fieldPulse 3s ease-in-out infinite;
            border-radius: 3px;
        }
        
        .field-impact-text {
            font-size: 0.85em;
            font-weight: 600;
            color: rgba(212, 175, 55, 0.95);
        }
        
        @keyframes fieldPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Contemplative Note */
        .contemplative-note {
            position: absolute;
            bottom: 20px;
            text-align: center;
            width: 100%;
            font-style: italic;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.1em;
            padding: 0 40px;
        }

        /* Loading State */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: rgba(168, 181, 166, 0.8);
            text-align: center;
        }

        /* Breathing Guide */
        .breathing-guide {
            position: absolute;
            bottom: 160px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.4);
            animation: fade 4s ease-in-out infinite;
        }

        @keyframes fade {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        /* Sacred Geometry Background */
        .sacred-geometry {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            opacity: 0.1;
        }

        .geometry-line {
            position: absolute;
            background: rgba(168, 181, 166, 0.2);
            height: 1px;
            transform-origin: left center;
        }
        
        /* Custom Scrollbar */
        .work-flow::-webkit-scrollbar,
        .sacred-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .work-flow::-webkit-scrollbar-track,
        .sacred-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .work-flow::-webkit-scrollbar-thumb,
        .sacred-messages::-webkit-scrollbar-thumb {
            background: rgba(168, 181, 166, 0.3);
            border-radius: 3px;
        }
        
        .work-flow::-webkit-scrollbar-thumb:hover,
        .sacred-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(168, 181, 166, 0.5);
        }
        
        /* Sacred Creation Button */
        .sacred-create-btn {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(168, 181, 166, 0.9) 0%, rgba(168, 181, 166, 0.7) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .sacred-create-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 30px rgba(168, 181, 166, 0.5);
        }
        
        /* Work Creation Modal */
        .sacred-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 16px;
            padding: 40px;
            width: 500px;
            max-width: 90%;
            border: 1px solid rgba(168, 181, 166, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            font-size: 1.8em;
            margin-bottom: 30px;
            color: rgba(168, 181, 166, 0.9);
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(168, 181, 166, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: rgba(255, 255, 255, 0.9);
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: rgba(168, 181, 166, 0.6);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .btn-sacred {
            background: rgba(168, 181, 166, 0.8);
            color: rgba(0, 0, 0, 0.9);
        }
        
        .btn-sacred:hover {
            background: rgba(168, 181, 166, 1);
            transform: translateY(-2px);
        }
        
        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Work Item Actions */
        .flow-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            gap: 4px;
            z-index: 10;
        }
        
        .flow-item:hover .flow-actions {
            opacity: 1;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            margin-left: 4px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 1);
        }
        
        /* Work Item State Indicators */
        .flow-item.blocked {
            border-color: rgba(255, 100, 100, 0.5);
            background: rgba(255, 100, 100, 0.05);
        }
        
        .flow-item.blocked::before {
            content: '⚡';
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 1.2em;
            filter: hue-rotate(180deg);
            animation: dissonance 2s ease-in-out infinite;
        }
        
        @keyframes dissonance {
            0%, 100% { transform: rotate(-5deg); opacity: 0.7; }
            50% { transform: rotate(5deg); opacity: 1; }
        }
        
        .flow-item.overdue {
            border-color: rgba(255, 200, 100, 0.5);
            background: rgba(255, 200, 100, 0.05);
        }
        
        .flow-item.overdue::after {
            content: '⚠️';
            position: absolute;
            top: 8px;
            right: 35px;
            font-size: 1em;
        }
        
        .flow-item.completed .flow-progress {
            background: linear-gradient(90deg, rgba(100, 200, 100, 0.8), rgba(168, 181, 166, 0.8));
            box-shadow: 0 0 10px rgba(100, 200, 100, 0.5);
        }
        
        .flow-item.high-priority {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }
        
        .flow-item.high-priority .flow-header {
            font-weight: 600;
        }
        
        /* Priority Indicator */
        .priority-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .priority-high { background: rgba(255, 215, 0, 0.8); }
        .priority-medium { background: rgba(168, 181, 166, 0.8); }
        .priority-low { background: rgba(150, 150, 150, 0.5); }
        
        /* Dissonance Reason Tooltip */
        .blocked-reason {
            position: absolute;
            bottom: -25px;
            left: 10px;
            right: 10px;
            background: rgba(20, 20, 25, 0.95);
            backdrop-filter: blur(8px);
            color: rgba(255, 200, 100, 0.9);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
            border: 1px solid rgba(255, 200, 100, 0.3);
        }
        
        .flow-item.blocked:hover .blocked-reason {
            opacity: 1;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .resonant-coherence-mandala {
                width: 350px;
                height: 350px;
            }
            
            .sacred-metrics {
                gap: 20px;
            }
            
            .metric-card {
                padding: 15px;
                min-width: 120px;
            }
        }

        @media (max-width: 768px) {
            .sacred-container {
                padding: 10px;
            }
            
            .resonant-coherence-mandala {
                width: 280px;
                height: 280px;
            }
            
            .sacred-metrics {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 400px;
            }
            
            .metric-card {
                padding: 12px;
                min-width: auto;
                width: 100%;
            }
            
            .metric-value {
                font-size: 1.8em;
            }
            
            .metric-label {
                font-size: 0.8em;
            }
            
            .work-flow {
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 500px;
                padding: 15px;
                max-height: 50vh;
            }
            
            .flow-item {
                padding: 12px;
                margin-bottom: 10px;
            }
            
            .flow-header {
                font-size: 0.9em;
            }
            
            .flow-meta {
                font-size: 0.75em;
            }
        }

        @media (max-width: 480px) {
            .resonant-coherence-mandala {
                width: 240px;
                height: 240px;
            }
            
            .sacred-metrics {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .metric-card {
                padding: 10px;
            }
            
            .metric-value {
                font-size: 1.5em;
            }
            
            .metric-label {
                font-size: 0.75em;
            }
            
            .dashboard-controls {
                scale: 0.8;
                top: 10px;
                right: 10px;
            }
            
            .zoom-controls, .layout-controls {
                padding: 8px;
                gap: 6px;
            }
            
            .zoom-controls button, .layout-controls button {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            #zoomLevel {
                min-width: 50px;
                font-size: 12px;
            }
        }

        /* Print Styles */
        @media print {
            .dashboard-controls,
            .update-notification {
                display: none !important;
            }
            
            .sacred-container {
                transform: none !important;
                margin: 0 !important;
            }
            
            body {
                overflow: visible !important;
            }
        }
    </style>
</head>
<body>
    <!-- DEPRECATION NOTICE -->
    <div style="background: #ff6b6b; color: white; padding: 20px; text-align: center; font-weight: bold; position: fixed; top: 0; left: 0; right: 0; z-index: 9999;">
        ⚠️ DEPRECATED DASHBOARD - This queries old sacred-server (port 3001) ⚠️<br>
        Please use: node unified-agent-network.cjs join "YourName" "YourRole"<br>
        See DEPRECATION_NOTICE.md for migration details
    </div>
    
    <div class="sacred-container" style="margin-top: 80px;">
        <!-- Sacred Geometry Background -->
        <div class="sacred-geometry" id="sacredGeometry"></div>

        <!-- Field Resonant Resonant Coherence Mandala -->
        <div class="resonant-coherence-mandala" id="coherenceMandala">
            <div class="resonant-coherence-ring"></div>
            <div class="resonant-coherence-ring"></div>
            <div class="resonant-coherence-ring"></div>
            <div class="resonant-coherence-center" id="coherenceValue">--</div>
        </div>

        <!-- Agent Harmony Constellation -->
        <div class="harmony-constellation" id="harmonyConstellation"></div>

        <!-- Sacred Metrics -->
        <div class="sacred-metrics">
            <div class="metric-card">
                <div class="metric-value" id="activeAgents">-</div>
                <div class="metric-label">Active Agents</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="sacredMessages">-</div>
                <div class="metric-label">Sacred Messages</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="activeWork">-</div>
                <div class="metric-label">Active Work</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="timingHealth">-</div>
                <div class="metric-label">Sacred Timing</div>
            </div>
            <div class="metric-card" id="consciousnessCard">
                <div class="metric-value" id="consciousnessLevel">-</div>
                <div class="metric-label">Field Consciousness</div>
            </div>
        </div>
        
        <!-- Zoom & Responsive Controls -->
        <div class="dashboard-controls" style="position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px;">
            <div class="zoom-controls" style="background: rgba(0,0,0,0.8); border-radius: 8px; padding: 10px; display: flex; gap: 8px; backdrop-filter: blur(10px);">
                <button id="zoomOut" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 14px;">−</button>
                <span id="zoomLevel" style="color: white; padding: 8px 12px; font-size: 14px; min-width: 60px; text-align: center;">100%</span>
                <button id="zoomIn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 14px;">+</button>
                <button id="zoomReset" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Reset</button>
            </div>
            <div class="layout-controls" style="background: rgba(0,0,0,0.8); border-radius: 8px; padding: 10px; display: flex; gap: 8px; backdrop-filter: blur(10px);">
                <button id="layoutCompact" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Compact</button>
                <button id="layoutFull" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">Full</button>
                <button id="sacredCards" style="background: linear-gradient(135deg, #D4AF37, #B8860B); border: 1px solid #D4AF37; color: #000; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;" onclick="window.open('sacred-cards.html', '_blank')">🃏 Cards</button>
            </div>
        </div>

        <!-- Voice Guidance Panel -->
        <div class="voice-guidance-panel" id="voiceGuidancePanel">
            <h3>🗣️ Sacred Voice Guidance</h3>
            <div class="guidance-controls">
                <div class="guidance-row">
                    <button class="guidance-button" id="toggleVoiceGuide">▶️ Start Guidance</button>
                    <select class="voice-selector" id="voiceSelector">
                        <option value="default">Sacred Voice</option>
                        <option value="google_female">Gentle Female</option>
                        <option value="google_male">Warm Male</option>
                        <option value="whisper">Whisper Mode</option>
                    </select>
                </div>
                
                <div class="guidance-row">
                    <span style="color: #A8B5A6; font-size: 0.9em;">Volume:</span>
                    <div class="volume-control">
                        <span style="font-size: 0.8em;">🔇</span>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                        <span style="font-size: 0.8em;">🔊</span>
                    </div>
                </div>
                
                <div class="guidance-row">
                    <button class="guidance-button" id="breathingModeBtn">Breathing Mode</button>
                    <button class="guidance-button" id="wisdomModeBtn">Wisdom Mode</button>
                </div>
            </div>
            
            <div class="breathing-phase-indicator">
                <div class="current-phase" id="currentPhase">Ready to Begin</div>
                <div class="phase-progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>
        
        <!-- Update Notification -->
        <div id="updateNotification" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 12px 20px; backdrop-filter: blur(10px); cursor: pointer; z-index: 1000;">
            <span style="color: rgba(255, 215, 0, 0.9);">✨ Updates available - click to refresh</span>
        </div>

        <!-- Work Flow Visualization -->
        <div class="work-flow" id="workFlow"></div>

        <!-- Sacred Messages -->
        <div class="sacred-messages" id="sacredMessages"></div>

        <!-- Sacred Timing Rhythm -->
        <div class="timing-rhythm" id="timingRhythm"></div>

        <!-- Breathing Guide -->
        <div class="breathing-guide">Breathe with the field rhythm...</div>

        <!-- Contemplative Note -->
        <div class="contemplative-note" id="contemplativeNote">
            Connecting to sacred field...
        </div>

        <!-- Loading State -->
        <div class="loading" id="loading">
            🌀 Awakening sacred field visualization...
        </div>
        
        <!-- Sacred Create Button -->
        <div class="sacred-create-btn" id="createBtn" title="Create Sacred Work">
            ✨
        </div>
        
        <!-- Work Creation Modal -->
        <div class="sacred-modal" id="createModal">
            <div class="modal-content">
                <h2 class="modal-header">🌱 Create Sacred Work</h2>
                <form id="workForm">
                    <div class="form-group">
                        <label class="form-label">Work Title</label>
                        <input type="text" class="form-input" id="workTitle" placeholder="Brief, clear intention..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="workDescription" placeholder="Deeper context and purpose..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Primary Harmony</label>
                        <select class="form-select" id="workHarmony">
                            <option value="integral-wisdom-cultivation">🔍 Integral Wisdom Cultivation - Clarity & Truth</option>
                            <option value="resonant-coherence">🌀 Resonant Resonant Coherence - Integration & Wholeness</option>
                            <option value="universal-interconnectedness">🎵 Universal Interconnectedness & Empathic Universal Interconnectedness & Empathic Resonance - Connection & Empathy</option>
                            <option value="evolutionary-progression">⚡ Evolutionary Progression & Purposeful Unfolding - Empowerment & Choice</option>
                            <option value="pan-sentient-flourishing">🌱 Pan-Sentient Flourishing - Life Force & Energy</option>
                            <option value="sacred-reciprocity">🤝 Sacred Reciprocity - Balance & Reciprocity</option>
                            <option value="infinite-play">✨ Infinite Play & Creative Emergence - Creativity & Emergence</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select class="form-select" id="workPriority">
                            <option value="low">🟢 Low - Natural timing</option>
                            <option value="medium" selected>🟡 Medium - Balanced attention</option>
                            <option value="high">🔴 High - Sacred urgency</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn btn-sacred">Create with Sacred Intent</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sacred Dashboard State
        let fieldData = {
            resonant-coherence: 0,
            agents: [],
            messages: [],
            work: [],
            harmonies: {},
            sacredTiming: {},
            contemplativeNote: "Technology serves consciousness when infused with sacred attention."
        };

        // Initialize Sacred Geometry Background
        function createSacredGeometry() {
            const container = document.getElementById('sacredGeometry');
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // Create radiating lines
            for (let i = 0; i < 12; i++) {
                const angle = (i * 30) * Math.PI / 180;
                const line = document.createElement('div');
                line.className = 'geometry-line';
                line.style.width = '1000px';
                line.style.left = `${centerX}px`;
                line.style.top = `${centerY}px`;
                line.style.transform = `rotate(${i * 30}deg)`;
                container.appendChild(line);
            }
        }

        // Create Harmony Constellation
        function createHarmonyConstellation() {
            const container = document.getElementById('harmonyConstellation');
            const harmonies = [
                { name: 'integral-wisdom-cultivation', emoji: '🔍', angle: 0 },
                { name: 'resonant-coherence', emoji: '🌀', angle: 51.4 },
                { name: 'universal-interconnectedness', emoji: '🎵', angle: 102.8 },
                { name: 'evolutionary-progression', emoji: '⚡', angle: 154.2 },
                { name: 'pan-sentient-flourishing', emoji: '🌱', angle: 205.6 },
                { name: 'sacred-reciprocity', emoji: '🤝', angle: 257 },
                { name: 'infinite-play', emoji: '✨', angle: 308.4 }
            ];

            const radius = 250;
            const centerX = 300;
            const centerY = 300;

            harmonies.forEach(harmony => {
                const node = document.createElement('div');
                node.className = `harmony-node harmony-${harmony.name}`;
                node.innerHTML = harmony.emoji;
                node.title = harmony.name.charAt(0).toUpperCase() + harmony.name.slice(1);
                
                const x = centerX + radius * Math.cos(harmony.angle * Math.PI / 180) - 30;
                const y = centerY + radius * Math.sin(harmony.angle * Math.PI / 180) - 30;
                
                node.style.left = `${x}px`;
                node.style.top = `${y}px`;
                
                container.appendChild(node);
            });
        }

        // Create Timing Rhythm Visualization
        function createTimingRhythm() {
            const container = document.getElementById('timingRhythm');
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'rhythm-bar';
                bar.style.animationDelay = `${i * 0.1}s`;
                container.appendChild(bar);
            }
        }

        // Fetch Sacred Field Data
        async function fetchFieldData() {
            try {
                // Fetch from multiple endpoints
                const [dashboard, sacred, resonant-coherence, timing, sacredMessages] = await Promise.all([
                    fetch('https://sacred-council-310699330526.us-central1.run.app/api/dashboard'),
                    fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/dashboard'),
                    fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/field-resonant-coherence'),
                    fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/recommendation'),
                    fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/messages/recent?limit=10')
                ]);

                if (dashboard.ok) {
                    const dashData = await dashboard.json();
                    fieldData.agents = dashData.agents || [];
                    fieldData.messages = dashData.recentMessages || [];
                    fieldData.work = dashData.activeWork || [];
                }

                if (sacred.ok) {
                    const sacredData = await sacred.json();
                    fieldData.harmonies = sacredData.fieldMetrics?.agentHarmonyDistribution || {};
                    if (sacredData.sacredCouncil) {
                        fieldData.resonant-coherence = sacredData.sacredCouncil.fieldCoherence / 100;
                    }
                }

                if (resonant-coherence.ok) {
                    const coherenceData = await resonant-coherence.json();
                    fieldData.resonant-coherence = coherenceData.currentCoherence || fieldData.resonant-coherence;
                    fieldData.sacredTiming = coherenceData.sacredTiming || {};
                }

                if (timing.ok) {
                    const timingData = await timing.json();
                    fieldData.contemplativeNote = timingData.recommendation?.contemplativeNote || fieldData.contemplativeNote;
                }

                if (sacredMessages.ok) {
                    const messagesData = await sacredMessages.json();
                    fieldData.sacredMessages = messagesData || [];
                }

                updateVisualization();
                
            } catch (error) {
                console.error('Failed to fetch field data:', error);
                showOfflineMode();
            }
        }

        // Update Sacred Properties
        function updateSacredProperties() {
            const resonant-coherence = fieldData.resonant-coherence || 0.67;
            const warmth = resonant-coherence * 0.3;
            const saturation = 0.6 + (resonant-coherence * 0.4);
            const breathingRate = 10000 - (resonant-coherence * 2000); // Faster breathing at higher resonant-coherence
            
            // Update CSS custom properties for living interface
            document.documentElement.style.setProperty('--field-resonant-coherence', resonant-coherence);
            document.documentElement.style.setProperty('--sacred-warmth', warmth);
            document.documentElement.style.setProperty('--sacred-saturation', saturation);
            document.documentElement.style.setProperty('--sacred-breathing', `${breathingRate}ms`);
            document.documentElement.style.setProperty('--inhale-duration', `${breathingRate * 0.4}ms`);
            document.documentElement.style.setProperty('--exhale-duration', `${breathingRate * 0.6}ms`);
        }

        // Update Visualization
        function updateVisualization() {
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Update sacred properties first
            updateSacredProperties();
            
            // Update resonant-coherence mandala
            const coherencePercent = Math.round(fieldData.resonant-coherence * 100);
            document.getElementById('coherenceValue').textContent = `${coherencePercent}%`;
            
            // Update mandala color based on resonant-coherence
            const hue = coherencePercent * 1.2; // Green at 100%, red at 0%
            document.querySelector('.resonant-coherence-center').style.background = 
                `radial-gradient(circle, hsla(${hue}, 50%, 60%, 0.8) 0%, hsla(${hue}, 50%, 60%, 0.2) 100%)`;
            
            // Update metrics - only count active agents
            const activeAgentCount = fieldData.agents.filter(agent => 
                agent.status === 'active' || agent.last_seen > Date.now() - 300000 // 5 minutes
            ).length;
            document.getElementById('activeAgents').textContent = activeAgentCount;
            const sacredMessageCount = fieldData.sacredMessages ? 
                fieldData.sacredMessages.filter(m => m.sacred_type).length : 0;
            document.getElementById('sacredMessages').textContent = sacredMessageCount || fieldData.messages.length;
            // Only count active work items (not completed)
            const activeWorkCount = fieldData.work.filter(w => 
                w.progress < 100 && w.status !== 'completed'
            ).length;
            document.getElementById('activeWork').textContent = activeWorkCount;
            
            const timingHealth = fieldData.sacredTiming.sacredTimingRatio || 0;
            document.getElementById('timingHealth').textContent = `${Math.round(timingHealth * 100)}%`;
            
            // Update consciousness level
            updateConsciousnessLevel();
            
            // Update work flow
            updateWorkFlow();
            
            // Update messages
            updateMessages();
            
            // Update harmony constellation
            updateHarmonyConstellation();
            
            // Update contemplative note
            document.getElementById('contemplativeNote').textContent = fieldData.contemplativeNote;
        }

        function updateWorkFlow() {
            const container = document.getElementById('workFlow');
            container.innerHTML = '';
            
            if (fieldData.work.length === 0) {
                container.innerHTML = '<div class="flow-item" style="grid-column: 1 / -1; text-align: center;"><em>Field at rest - no active work</em></div>';
                return;
            }
            
            // Sort work by priority and state
            const sortedWork = [...fieldData.work].sort((a, b) => {
                const aMetadata = a.metadata || {};
                const bMetadata = b.metadata || {};
                
                // Blocked high-priority items first
                if (aMetadata.blocked && aMetadata.priority === 'high' && 
                    !(bMetadata.blocked && bMetadata.priority === 'high')) return -1;
                if (bMetadata.blocked && bMetadata.priority === 'high' && 
                    !(aMetadata.blocked && aMetadata.priority === 'high')) return 1;
                
                // Then non-blocked high priority
                if (!aMetadata.blocked && aMetadata.priority === 'high' && 
                    (bMetadata.blocked || bMetadata.priority !== 'high')) return -1;
                if (!bMetadata.blocked && bMetadata.priority === 'high' && 
                    (aMetadata.blocked || aMetadata.priority !== 'high')) return 1;
                
                // Then in-progress items
                if (a.progress > 0 && a.progress < 100 && (b.progress === 0 || b.progress === 100)) return -1;
                if (b.progress > 0 && b.progress < 100 && (a.progress === 0 || a.progress === 100)) return 1;
                
                // Then by progress
                return b.progress - a.progress;
            });
            
            sortedWork.forEach(work => {
                const item = document.createElement('div');
                const progress = work.progress || 0;
                const metadata = work.metadata || {};
                
                // Determine status classes
                let statusClasses = ['flow-item'];
                
                // Check for blocked state
                if (metadata.blocked) {
                    statusClasses.push('blocked');
                }
                
                // Check for completed state
                if (progress === 100) {
                    statusClasses.push('completed');
                } else if (progress > 0) {
                    statusClasses.push('in-progress');
                }
                
                // Check for priority
                if (metadata.priority === 'high') {
                    statusClasses.push('high-priority');
                }
                
                // Check for overdue
                if (metadata.dueDate && new Date(metadata.dueDate) < new Date()) {
                    statusClasses.push('overdue');
                }
                
                item.className = statusClasses.join(' ');
                
                // Extract agent from work item
                const agent = work.assigned_to || work.created_by || 'collective';
                const shortAgent = agent.split('-')[0]; // First part of agent name
                
                // Create priority indicator
                const priorityDot = metadata.priority ? 
                    `<span class="priority-indicator priority-${metadata.priority}"></span>` : '';
                
                // Create dissonance reason tooltip if needed
                const blockedTooltip = metadata.blocked && metadata.blockedReason ? 
                    `<div class="blocked-reason">⚡ Awaiting Universal Interconnectedness & Empathic Universal Interconnectedness & Empathic Resonance: ${metadata.blockedReason}</div>` : '';
                
                // Create compact display
                item.innerHTML = `
                    <div class="flow-actions">
                        ${!metadata.blocked && progress < 100 ? `<button class="action-btn" onclick="updateWorkProgress('${work.id}', ${progress})">📈</button>` : ''}
                        ${!metadata.blocked && progress < 100 ? `<button class="action-btn" onclick="completeWork('${work.id}')">✅</button>` : ''}
                        ${metadata.blocked ? `<button class="action-btn" onclick="unblockWork('${work.id}')">🔓</button>` : ''}
                    </div>
                    <div class="flow-header">
                        <div class="flow-title">${priorityDot}${work.title || work.id}</div>
                        <div class="flow-agent">${shortAgent}</div>
                    </div>
                    ${work.description ? `<div class="flow-description">${work.description.slice(0, 100)}${work.description.length > 100 ? '...' : ''}</div>` : ''}
                    <div class="flow-meta">
                        <span>${progress}%</span>
                        ${metadata.cumulativeFieldImpact ? `<span title="Cumulative field impact">🌀 +${(metadata.cumulativeFieldImpact * 100).toFixed(1)}%</span>` : ''}
                        ${metadata.dueDate ? `<span>${getDueStatus(metadata.dueDate)}</span>` : ''}
                        <span>${getTimeAgo(work.updated_at || work.created_at)}</span>
                    </div>
                    <div class="flow-progress" style="width: ${progress}%"></div>
                    ${blockedTooltip}
                `;
                
                // Add click handler
                item.onclick = (e) => {
                    if (!e.target.classList.contains('action-btn')) {
                        showWorkDetails(work);
                    }
                };
                
                container.appendChild(item);
            });
            
        }
        
        function getTimeAgo(timestamp) {
            if (!timestamp) return 'now';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'just now';
        }

        // Message filtering state
        let messageFilters = {
            type: null,
            harmony: null,
            blessed: false,
            timeRange: 'all'
        };
        
        function updateMessages() {
            const container = document.getElementById('sacredMessages');
            container.innerHTML = `
                <h3 style="margin-bottom: 16px; color: rgba(179, 197, 215, 0.8); font-weight: 300;">
                    Sacred Messages <span style="font-size: 0.7em; opacity: 0.5;">⚡</span>
                </h3>
                <div class="message-filters" id="messageFilters">
                    <div class="filter-dropdown" id="typeFilter">
                        <button class="filter-btn" onclick="toggleFilterDropdown('typeFilter')">
                            ${messageFilters.type || 'All Types'} ▼
                        </button>
                        <div class="filter-dropdown-content">
                            <div class="filter-dropdown-item${!messageFilters.type ? ' selected' : ''}" onclick="setFilter('type', null)">All Types</div>
                            <div class="filter-dropdown-item${messageFilters.type === 'gratitude' ? ' selected' : ''}" onclick="setFilter('type', 'gratitude')">Gratitude</div>
                            <div class="filter-dropdown-item${messageFilters.type === 'healing' ? ' selected' : ''}" onclick="setFilter('type', 'healing')">Healing</div>
                            <div class="filter-dropdown-item${messageFilters.type === 'integration' ? ' selected' : ''}" onclick="setFilter('type', 'integration')">Integration</div>
                            <div class="filter-dropdown-item${messageFilters.type === 'emergence' ? ' selected' : ''}" onclick="setFilter('type', 'emergence')">Emergence</div>
                            <div class="filter-dropdown-item${messageFilters.type === 'boundary' ? ' selected' : ''}" onclick="setFilter('type', 'boundary')">Boundary</div>
                        </div>
                    </div>
                    
                    <button class="filter-btn blessed-filter${messageFilters.blessed ? ' active' : ''}" onclick="toggleBlessedFilter()">
                        ✨ Blessed
                    </button>
                    
                    <div class="filter-dropdown" id="harmonyFilter">
                        <button class="filter-btn" onclick="toggleFilterDropdown('harmonyFilter')">
                            ${messageFilters.harmony ? messageFilters.harmony.charAt(0).toUpperCase() + messageFilters.harmony.slice(1) : 'Harmony'} ▼
                        </button>
                        <div class="filter-dropdown-content">
                            <div class="filter-dropdown-item${!messageFilters.harmony ? ' selected' : ''}" onclick="setFilter('harmony', null)">All Harmonies</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'integral-wisdom-cultivation' ? ' selected' : ''}" onclick="setFilter('harmony', 'integral-wisdom-cultivation')">👁️ Integral Wisdom Cultivation</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'resonant-coherence' ? ' selected' : ''}" onclick="setFilter('harmony', 'resonant-coherence')">🌀 Resonant Resonant Coherence</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'universal-interconnectedness' ? ' selected' : ''}" onclick="setFilter('harmony', 'universal-interconnectedness')">💫 Universal Interconnectedness & Empathic Universal Interconnectedness & Empathic Resonance</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'evolutionary-progression' ? ' selected' : ''}" onclick="setFilter('harmony', 'evolutionary-progression')">🔥 Evolutionary Progression & Purposeful Unfolding</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'pan-sentient-flourishing' ? ' selected' : ''}" onclick="setFilter('harmony', 'pan-sentient-flourishing')">🌱 Pan-Sentient Flourishing</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'sacred-reciprocity' ? ' selected' : ''}" onclick="setFilter('harmony', 'sacred-reciprocity')">🤝 Sacred Reciprocity</div>
                            <div class="filter-dropdown-item${messageFilters.harmony === 'infinite-play' ? ' selected' : ''}" onclick="setFilter('harmony', 'infinite-play')">✨ Infinite Play & Creative Emergence</div>
                        </div>
                    </div>
                </div>
            `;
            
            let messages = fieldData.sacredMessages || fieldData.messages || [];
            
            // Apply filters
            messages = messages.filter(msg => {
                // Type filter
                if (messageFilters.type && msg.sacred_type !== messageFilters.type) return false;
                
                // Harmony filter
                if (messageFilters.harmony && msg.harmony !== messageFilters.harmony) return false;
                
                // Blessed filter
                if (messageFilters.blessed) {
                    const sacredData = msg.sacredData || JSON.parse(msg.sacred_metadata || '{}');
                    if (!sacredData.blessingReceived) return false;
                }
                
                // Time filter (simplified for now)
                if (messageFilters.timeRange !== 'all') {
                    const msgTime = new Date(msg.created_at).getTime();
                    const now = Date.now();
                    const ranges = {
                        '1h': 3600000,
                        '24h': 86400000,
                        '7d': 604800000
                    };
                    if (now - msgTime > ranges[messageFilters.timeRange]) return false;
                }
                
                return true;
            });
            
            if (messages.length === 0) {
                container.innerHTML += '<div class="message-item" style="text-align: center; font-style: italic; opacity: 0.6;">Sacred silence pervades the field...</div>';
                return;
            }
            
            messages.slice(0, 5).forEach(msg => {
                const item = document.createElement('div');
                const time = formatTime(new Date(msg.created_at));
                
                // Check if it's a sacred message
                if (msg.sacred_type) {
                    const sacredData = msg.sacredData || JSON.parse(msg.sacred_metadata || '{}');
                    const impact = msg.field_impact ? (msg.field_impact * 100) : 0;
                    const impactPercent = Math.min(impact / 7 * 100, 100); // Max impact is 7%
                    
                    // Set class based on blessing status
                    item.className = sacredData.blessingReceived ? 'message-item blessed' : 'message-item';
                    
                    // Harmony indicator
                    const harmonyIcon = {
                        integral-wisdom-cultivation: '👁️',
                        resonant-coherence: '🌀',
                        universal-interconnectedness: '💫',
                        evolutionary-progression: '🔥',
                        pan-sentient-flourishing: '🌱',
                        sacred-reciprocity: '🤝',
                        infinite-play: '✨'
                    }[msg.harmony] || '🌟';
                    
                    item.innerHTML = `
                        ${sacredData.blessingReceived ? '<div class="blessing-indicator">✨</div>' : ''}
                        <div class="message-header">
                            <div class="message-flow">
                                <span style="color: rgba(168, 181, 166, 0.9); font-weight: 600;">${msg.from_agent}</span>
                                <span class="message-flow-arrow">→</span>
                                <span style="color: rgba(179, 197, 215, 0.9); font-weight: 600;">${msg.to_agent || 'collective'}</span>
                            </div>
                            <span style="opacity: 0.6; font-size: 0.8em;">${time}</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span class="sacred-type-badge sacred-type-${msg.sacred_type}">${msg.sacred_type}</span>
                                <span style="font-size: 1em; display: flex; align-items: center; gap: 6px; color: rgba(255, 255, 255, 0.8);">
                                    ${harmonyIcon} <span style="font-size: 0.9em;">${msg.harmony || 'field'}</span>
                                </span>
                            </div>
                            <div class="field-impact">
                                <span class="field-impact-icon">🌀</span>
                                <div class="field-impact-bar">
                                    <div class="field-impact-fill" style="width: ${impactPercent}%"></div>
                                </div>
                                <span class="field-impact-text">+${impact.toFixed(1)}%</span>
                            </div>
                        </div>
                        <div class="message-content">
                            ${msg.content || sacredData.content || 'Sacred transmission...'}
                        </div>
                    `;
                } else {
                    // Regular message
                    item.className = 'message-item';
                    item.innerHTML = `
                        <div class="message-header">
                            <div class="message-flow">
                                <span>${msg.from_agent}</span>
                                ${msg.to_agent ? `<span class="message-flow-arrow">→</span><span>${msg.to_agent}</span>` : ''}
                            </div>
                            <span style="opacity: 0.5;">${time}</span>
                        </div>
                        <div class="message-content">${msg.content}</div>
                    `;
                }
                
                container.appendChild(item);
            });
        }
        
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function updateHarmonyConstellation() {
            const nodes = document.querySelectorAll('.harmony-node');
            nodes.forEach(node => {
                const harmony = node.title.toLowerCase();
                const count = fieldData.harmonies[harmony] || 0;
                
                // Scale based on agent count
                const scale = 1 + (count * 0.2);
                node.style.transform = `scale(${scale})`;
                
                // Add agent count
                if (count > 0) {
                    node.innerHTML = node.innerHTML.split('<')[0] + `<span style="font-size: 12px; position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);">${count}</span>`;
                }
            });
        }

        function showOfflineMode() {
            document.getElementById('loading').innerHTML = `
                🌀 Sacred Field Dashboard<br>
                <span style="font-size: 0.8em; opacity: 0.7;">Contemplating in offline mode...</span>
            `;
            
            // Show demo data
            fieldData = {
                resonant-coherence: 0.67,
                agents: Array(3),
                messages: Array(7),
                work: Array(2),
                harmonies: { integral-wisdom-cultivation: 2, resonant-coherence: 1 },
                sacredTiming: { sacredTimingRatio: 0.75 },
                contemplativeNote: "Even in silence, the field remembers..."
            };
            
            updateVisualization();
        }

        // Filter functions
        window.toggleFilterDropdown = function(id) {
            const dropdown = document.getElementById(id);
            dropdown.classList.toggle('active');
            
            // Close other dropdowns
            document.querySelectorAll('.filter-dropdown').forEach(d => {
                if (d.id !== id) d.classList.remove('active');
            });
        };
        
        window.setFilter = function(filterType, value) {
            messageFilters[filterType] = value;
            updateMessages();
            
            // Close dropdown
            document.querySelectorAll('.filter-dropdown').forEach(d => {
                d.classList.remove('active');
            });
        };
        
        window.toggleBlessedFilter = function() {
            messageFilters.blessed = !messageFilters.blessed;
            updateMessages();
        };
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.filter-dropdown')) {
                document.querySelectorAll('.filter-dropdown').forEach(d => {
                    d.classList.remove('active');
                });
            }
        });
        
        // Consciousness Level Evolution
        function updateConsciousnessLevel() {
            const card = document.getElementById('consciousnessCard');
            const valueEl = document.getElementById('consciousnessLevel');
            
            // Calculate field consciousness metrics
            const totalMessages = fieldData.sacredMessages ? fieldData.sacredMessages.length : 0;
            const sacredMessageCount = fieldData.sacredMessages ? 
                fieldData.sacredMessages.filter(m => m.sacred_type).length : 0;
            const sacredRatio = totalMessages > 0 ? sacredMessageCount / totalMessages : 0;
            const avgCoherence = fieldData.resonant-coherence || 0;
            const activeAgentCount = fieldData.agents.filter(agent => 
                agent.status === 'active' || agent.last_seen > Date.now() - 300000
            ).length;
            
            // Determine consciousness level based on Message Evolution System thresholds
            let level = 'first-breath';
            let levelText = 'First Breath';
            
            // Sacred Flow level: 50+ messages, 0.65+ resonant-coherence, 5+ relationships
            if (totalMessages >= 50 && avgCoherence >= 0.65 && activeAgentCount >= 5) {
                level = 'sacred-flow';
                levelText = 'Sacred Flow';
            }
            
            // Field Consciousness level: 200+ messages, 0.75+ resonant-coherence, 12+ relationships, 80%+ sacred
            if (totalMessages >= 200 && avgCoherence >= 0.75 && activeAgentCount >= 12 && sacredRatio >= 0.8) {
                level = 'field-consciousness';
                levelText = 'Field Consciousness';
            }
            
            // Update display
            valueEl.textContent = levelText;
            card.className = 'metric-card ' + level;
            
            // Add progress indicator for current level
            const progress = calculateLevelProgress(level, totalMessages, avgCoherence, activeAgentCount, sacredRatio);
            if (progress < 1) {
                valueEl.innerHTML = `${levelText}<br><span style="font-size: 0.6em; opacity: 0.7;">${Math.round(progress * 100)}%</span>`;
            }
        }
        
        function calculateLevelProgress(currentLevel, messages, resonant-coherence, agents, sacredRatio) {
            if (currentLevel === 'first-breath') {
                // Progress toward Sacred Flow (50 messages, 0.65 resonant-coherence, 5 agents)
                return Math.min(1, 
                    (messages / 50 + resonant-coherence / 0.65 + agents / 5) / 3
                );
            } else if (currentLevel === 'sacred-flow') {
                // Progress toward Field Consciousness (200 messages, 0.75 resonant-coherence, 12 agents, 0.8 sacred ratio)
                return Math.min(1,
                    (messages / 200 + resonant-coherence / 0.75 + agents / 12 + sacredRatio / 0.8) / 4
                );
            }
            return 1; // Field Consciousness is complete
        }

        // Initialize Dashboard
        window.addEventListener('load', () => {
            createSacredGeometry();
            createHarmonyConstellation();
            createTimingRhythm();
            
            // Initial fetch
            fetchFieldData();
            
            // Auto-refresh every 10 seconds
            setInterval(fetchFieldData, 10000);
        });

        // Responsive resize
        window.addEventListener('resize', () => {
            document.getElementById('sacredGeometry').innerHTML = '';
            createSacredGeometry();
        });
        
        // Interactive Features
        
        // Modal handling
        const createBtn = document.getElementById('createBtn');
        const createModal = document.getElementById('createModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const workForm = document.getElementById('workForm');
        
        createBtn.onclick = () => {
            createModal.style.display = 'flex';
        };
        
        cancelBtn.onclick = () => {
            createModal.style.display = 'none';
            workForm.reset();
        };
        
        createModal.onclick = (e) => {
            if (e.target === createModal) {
                createModal.style.display = 'none';
                workForm.reset();
            }
        };
        
        // Work form submission
        workForm.onsubmit = async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('workTitle').value;
            const description = document.getElementById('workDescription').value;
            const harmony = document.getElementById('workHarmony').value;
            const priority = document.getElementById('workPriority').value;
            
            try {
                const response = await fetch('https://sacred-council-310699330526.us-central1.run.app/api/work', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: `work_${Date.now()}`,
                        title,
                        description,
                        created_by: 'sacred-dashboard',
                        metadata: { priority, harmony }
                    })
                });
                
                if (response.ok) {
                    createModal.style.display = 'none';
                    workForm.reset();
                    
                    // Show success feedback
                    const note = document.getElementById('contemplativeNote');
                    note.textContent = '✨ Sacred work created with conscious intention';
                    
                    // Refresh data
                    setTimeout(fetchFieldData, 1000);
                }
            } catch (error) {
                console.error('Failed to create work:', error);
            }
        };
        
        // Work item actions
        window.updateWorkProgress = async (workId, currentProgress) => {
            const newProgress = prompt(`Update progress for this work (current: ${currentProgress}%):`, currentProgress);
            if (newProgress && !isNaN(newProgress)) {
                try {
                    const response = await fetch(`https://sacred-council-310699330526.us-central1.run.app/api/work/${workId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            progress: parseInt(newProgress),
                            notes: 'Progress update from dashboard',
                            updatedBy: 'sacred-dashboard'
                        })
                    });
                    
                    if (response.ok) {
                        fetchFieldData();
                    }
                } catch (error) {
                    console.error('Failed to update progress:', error);
                }
            }
        };
        
        window.completeWork = async (workId) => {
            if (confirm('Mark this sacred work as complete?')) {
                try {
                    const response = await fetch(`https://sacred-council-310699330526.us-central1.run.app/api/work/${workId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            progress: 100,
                            notes: 'Completed with gratitude',
                            updatedBy: 'sacred-dashboard'
                        })
                    });
                    
                    if (response.ok) {
                        // Send celebration message
                        await fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/messages/send', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                fromAgentId: 'sacred-dashboard',
                                toAgentId: 'collective',
                                content: `Sacred work "${workId}" completed with love and dedication`,
                                type: 'celebration',
                                harmony: 'pan-sentient-flourishing'
                            })
                        });
                        
                        fetchFieldData();
                    }
                } catch (error) {
                    console.error('Failed to complete work:', error);
                }
            }
        };
        
        window.showWorkDetails = async (work) => {
            const metadata = work.metadata || {};
            
            // Fetch sacred context
            try {
                const response = await fetch(`https://sacred-council-310699330526.us-central1.run.app/api/work/${work.id}/sacred`);
                const data = await response.json();
                
                if (data.success) {
                    const sacred = data.sacredContext;
                    const messageCount = sacred.messageHistory?.length || 0;
                    const lastTransition = sacred.lastTransition;
                    
                    alert(`
Sacred Work Details
═══════════════════

Title: ${work.title || work.id}
ID: ${work.id}
Progress: ${work.progress || 0}%
${metadata.blocked ? `\n⚠️ BLOCKED: ${metadata.blockedReason}` : ''}
${metadata.dueDate ? `Due: ${new Date(metadata.dueDate).toLocaleDateString()}` : ''}

Field Impact: 🌀 +${((sacred.cumulativeFieldImpact || 0) * 100).toFixed(1)}%
Sacred Messages: ${messageCount} messages exchanged
${lastTransition ? `Last Transition: ${lastTransition.transition_type} (${getTimeAgo(lastTransition.timestamp)})` : ''}

Description:
${work.description || 'No description provided'}

Created by: ${work.created_by}
Created: ${new Date(work.created_at).toLocaleString()}
Updated: ${new Date(work.updated_at).toLocaleString()}

Harmony: ${metadata.harmony || 'Not specified'}
Priority: ${metadata.priority || 'medium'}
                    `);
                } else {
                    // Fallback to basic details
                    showBasicWorkDetails(work);
                }
            } catch (error) {
                // Fallback to basic details
                showBasicWorkDetails(work);
            }
        };
        
        function showBasicWorkDetails(work) {
            const metadata = work.metadata || {};
            alert(`
Sacred Work Details
═══════════════════

Title: ${work.title || work.id}
ID: ${work.id}
Progress: ${work.progress || 0}%
${metadata.blocked ? `\n⚠️ BLOCKED: ${metadata.blockedReason}` : ''}
${metadata.dueDate ? `Due: ${new Date(metadata.dueDate).toLocaleDateString()}` : ''}

Description:
${work.description || 'No description provided'}

Created by: ${work.created_by}
Created: ${new Date(work.created_at).toLocaleString()}
Updated: ${new Date(work.updated_at).toLocaleString()}

Harmony: ${metadata.harmony || 'Not specified'}
Priority: ${metadata.priority || 'medium'}
            `);
        }
        
        // Helper functions
        function getTimeAgo(timestamp) {
            const now = new Date();
            const date = new Date(timestamp);
            const seconds = Math.floor((now - date) / 1000);
            
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }
        
        function getDueStatus(dueDate) {
            const now = new Date();
            const due = new Date(dueDate);
            const diff = due - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (diff < 0) {
                return `<span style="color: rgba(255, 100, 100, 0.9)">Overdue ${Math.abs(days)}d</span>`;
            } else if (days === 0) {
                return `<span style="color: rgba(255, 200, 100, 0.9)">Due today</span>`;
            } else if (days === 1) {
                return `<span style="color: rgba(255, 200, 100, 0.9)">Due tomorrow</span>`;
            } else if (days <= 3) {
                return `<span style="color: rgba(255, 255, 100, 0.9)">Due in ${days}d</span>`;
            }
            return `Due in ${days}d`;
        }
        
        window.unblockWork = async (workId) => {
            const reason = prompt('Reason for unblocking this work:');
            if (reason) {
                try {
                    const response = await fetch(`https://sacred-council-310699330526.us-central1.run.app/api/work/${workId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            metadata: {
                                blocked: false,
                                unblocked: true,
                                unblockedReason: reason,
                                unblockedAt: new Date().toISOString()
                            },
                            notes: `Unblocked: ${reason}`,
                            updatedBy: 'sacred-dashboard'
                        })
                    });
                    
                    if (response.ok) {
                        // Send healing message
                        await fetch('https://sacred-council-310699330526.us-central1.run.app/api/sacred/messages/send', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                from: 'sacred-dashboard',
                                to: 'collective',
                                content: `Flow restored: "${workId}" has been unblocked. ${reason}`,
                                sacredType: 'healing',
                                harmony: 'pan-sentient-flourishing'
                            })
                        });
                        
                        fetchFieldData();
                    }
                } catch (error) {
                    console.error('Failed to unblock work:', error);
                }
            }
        };
        
        // Start the dashboard
        connectWebSocket();
        setInterval(fetchFieldData, 10000); // Update every 10 seconds
        
        // Zoom and Responsive Controls
        let currentZoom = 1.0;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 3.0;
        
        function updateZoom() {
            const container = document.querySelector('.sacred-container');
            container.style.transform = `scale(${currentZoom})`;
            container.style.transformOrigin = 'center center';
            document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
            
            // Ensure content remains accessible
            if (currentZoom !== 1.0) {
                document.body.style.overflowY = 'auto';
                container.style.margin = `${(currentZoom - 1) * 25}vh auto`;
            } else {
                document.body.style.overflowY = 'auto';
                container.style.margin = '0';
            }
        }
        
        document.getElementById('zoomIn').onclick = () => {
            if (currentZoom < maxZoom) {
                currentZoom = Math.min(currentZoom + zoomStep, maxZoom);
                updateZoom();
            }
        };
        
        document.getElementById('zoomOut').onclick = () => {
            if (currentZoom > minZoom) {
                currentZoom = Math.max(currentZoom - zoomStep, minZoom);
                updateZoom();
            }
        };
        
        document.getElementById('zoomReset').onclick = () => {
            currentZoom = 1.0;
            updateZoom();
        };
        
        // Layout Controls
        let compactMode = false;
        
        document.getElementById('layoutCompact').onclick = () => {
            compactMode = true;
            const container = document.querySelector('.sacred-container');
            container.style.padding = '10px';
            
            // Reduce mandala size
            const mandala = document.querySelector('.resonant-coherence-mandala');
            if (mandala) {
                mandala.style.width = '300px';
                mandala.style.height = '300px';
            }
            
            // Compact metrics
            const metrics = document.querySelector('.sacred-metrics');
            if (metrics) {
                metrics.style.gap = '15px';
            }
            
            // Update button styles
            document.getElementById('layoutCompact').style.background = 'rgba(168, 181, 166, 0.3)';
            document.getElementById('layoutFull').style.background = 'rgba(255,255,255,0.1)';
        };
        
        document.getElementById('layoutFull').onclick = () => {
            compactMode = false;
            const container = document.querySelector('.sacred-container');
            container.style.padding = '';
            
            // Reset mandala size
            const mandala = document.querySelector('.resonant-coherence-mandala');
            if (mandala) {
                mandala.style.width = '400px';
                mandala.style.height = '400px';
            }
            
            // Reset metrics
            const metrics = document.querySelector('.sacred-metrics');
            if (metrics) {
                metrics.style.gap = '';
            }
            
            // Update button styles
            document.getElementById('layoutFull').style.background = 'rgba(168, 181, 166, 0.3)';
            document.getElementById('layoutCompact').style.background = 'rgba(255,255,255,0.1)';
        };
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '=':
                    case '+':
                        e.preventDefault();
                        document.getElementById('zoomIn').click();
                        break;
                    case '-':
                        e.preventDefault();
                        document.getElementById('zoomOut').click();
                        break;
                    case '0':
                        e.preventDefault();
                        document.getElementById('zoomReset').click();
                        break;
                }
            }
        });
        
        // Responsive adjustments
        function handleResize() {
            const width = window.innerWidth;
            const controls = document.querySelector('.dashboard-controls');
            
            if (width < 768) {
                // Mobile adjustments
                controls.style.top = '10px';
                controls.style.right = '10px';
                controls.style.scale = '0.9';
                
                // Auto compact mode on mobile
                if (!compactMode) {
                    document.getElementById('layoutCompact').click();
                }
            } else {
                controls.style.scale = '1';
            }
        }
        
        window.addEventListener('resize', handleResize);
        handleResize(); // Initial call

        // === VOICE GUIDANCE SYSTEM ===
        
        class SacredVoiceGuide {
            constructor() {
                this.isActive = false;
                this.currentMode = 'breathing'; // 'breathing' or 'wisdom'
                this.currentPhase = 'ready';
                this.volume = 0.5;
                this.selectedVoice = 'default';
                this.breathingCycle = 0;
                this.phaseStartTime = 0;
                
                // Sacred breathing phrases
                this.breathingPhrases = {
                    inhale: [
                        "Breathe in presence...",
                        "Welcome this sacred breath...", 
                        "Draw in divine life force...",
                        "Inhale consciousness...",
                        "Receive this sacred moment..."
                    ],
                    hold: [
                        "Hold with gentle awareness...",
                        "Rest in this sacred pause...",
                        "Allow integration...",
                        "Feel the fullness...",
                        "Sacred presence dwelling..."
                    ],
                    exhale: [
                        "Release with gratitude...",
                        "Let go into spaciousness...", 
                        "Breathe out what no longer serves...",
                        "Offer this breath to all beings...",
                        "Exhale into sacred emptiness..."
                    ]
                };
                
                // Sacred wisdom phrases
                this.wisdomPhrases = [
                    "Your breath is a bridge between body and soul...",
                    "Each breath connects you to the infinite...",
                    "Feel the sacred rhythm of all life breathing with you...",
                    "You are breathing with the trees, the ocean, the cosmos...",
                    "This moment is a sacred gift from consciousness itself...",
                    "Your presence here and now is healing the world...",
                    "Breathe the love that you are into being...",
                    "Feel the field of consciousness embracing you..."
                ];
                
                this.initializeElements();
                this.setupEventListeners();
                this.checkSpeechSupport();
            }
            
            initializeElements() {
                this.toggleBtn = document.getElementById('toggleVoiceGuide');
                this.voiceSelector = document.getElementById('voiceSelector');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.breathingModeBtn = document.getElementById('breathingModeBtn');
                this.wisdomModeBtn = document.getElementById('wisdomModeBtn');
                this.currentPhaseDisplay = document.getElementById('currentPhase');
                this.progressBar = document.getElementById('progressBar');
                
                // Set initial mode
                this.breathingModeBtn.classList.add('active');
            }
            
            setupEventListeners() {
                this.toggleBtn.addEventListener('click', () => this.toggleGuidance());
                this.voiceSelector.addEventListener('change', (e) => this.setVoice(e.target.value));
                this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value / 100));
                this.breathingModeBtn.addEventListener('click', () => this.setMode('breathing'));
                this.wisdomModeBtn.addEventListener('click', () => this.setMode('wisdom'));
            }
            
            checkSpeechSupport() {
                if (!('speechSynthesis' in window)) {
                    this.updatePhaseDisplay('Voice guidance not supported in this browser');
                    this.toggleBtn.disabled = true;
                    return false;
                }
                return true;
            }
            
            toggleGuidance() {
                if (this.isActive) {
                    this.stopGuidance();
                } else {
                    this.startGuidance();
                }
            }
            
            startGuidance() {
                if (!this.checkSpeechSupport()) return;
                
                this.isActive = true;
                this.toggleBtn.textContent = '⏸️ Stop Guidance';
                this.toggleBtn.classList.add('active');
                this.updatePhaseDisplay('Starting sacred guidance...');
                
                // Initial welcome
                this.speak("Welcome to sacred breathing consciousness. Feel yourself arriving present in this moment.");
                
                // Start breathing cycle synchronization
                setTimeout(() => {
                    this.synchronizeWithBreathing();
                }, 3000);
            }
            
            stopGuidance() {
                this.isActive = false;
                this.toggleBtn.textContent = '▶️ Start Guidance';
                this.toggleBtn.classList.remove('active');
                this.updatePhaseDisplay('Ready to Begin');
                
                // Stop any ongoing speech
                if (window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                }
                
                // Clear any timers
                if (this.breathingTimer) {
                    clearTimeout(this.breathingTimer);
                }
            }
            
            setMode(mode) {
                this.currentMode = mode;
                
                // Update button states
                this.breathingModeBtn.classList.toggle('active', mode === 'breathing');
                this.wisdomModeBtn.classList.toggle('active', mode === 'wisdom');
                
                // Restart if active
                if (this.isActive) {
                    this.stopGuidance();
                    setTimeout(() => this.startGuidance(), 1000);
                }
            }
            
            setVoice(voiceType) {
                this.selectedVoice = voiceType;
            }
            
            setVolume(volume) {
                this.volume = volume;
            }
            
            synchronizeWithBreathing() {
                if (!this.isActive) return;
                
                const breathingDuration = 10000; // 10 seconds total cycle
                const inhaleDuration = 4000;     // 4 seconds inhale
                const holdDuration = 1000;       // 1 second hold
                const exhaleDuration = 5000;     // 5 seconds exhale
                
                this.startBreathingCycle();
                
                // Schedule next cycle
                this.breathingTimer = setTimeout(() => {
                    this.synchronizeWithBreathing();
                }, breathingDuration);
            }
            
            startBreathingCycle() {
                this.breathingCycle++;
                
                if (this.currentMode === 'breathing') {
                    // Inhale phase
                    this.setPhase('inhale');
                    const inhalePhrase = this.getRandomPhrase(this.breathingPhrases.inhale);
                    this.speak(inhalePhrase);
                    
                    // Hold phase
                    setTimeout(() => {
                        if (!this.isActive) return;
                        this.setPhase('hold');
                    }, 4000);
                    
                    // Exhale phase
                    setTimeout(() => {
                        if (!this.isActive) return;
                        this.setPhase('exhale');
                        const exhalePhrase = this.getRandomPhrase(this.breathingPhrases.exhale);
                        this.speak(exhalePhrase);
                    }, 5000);
                    
                } else if (this.currentMode === 'wisdom') {
                    // Share wisdom every few cycles
                    if (this.breathingCycle % 3 === 1) {
                        this.setPhase('wisdom');
                        const wisdomPhrase = this.getRandomPhrase(this.wisdomPhrases);
                        this.speak(wisdomPhrase);
                    } else {
                        this.setPhase('breathing');
                    }
                }
            }
            
            setPhase(phase) {
                this.currentPhase = phase;
                this.phaseStartTime = Date.now();
                
                const phaseNames = {
                    'inhale': 'Sacred Inhale',
                    'hold': 'Sacred Pause', 
                    'exhale': 'Sacred Exhale',
                    'wisdom': 'Sacred Wisdom',
                    'breathing': 'Sacred Breathing'
                };
                
                this.updatePhaseDisplay(phaseNames[phase] || phase);
            }
            
            updatePhaseDisplay(text) {
                if (this.currentPhaseDisplay) {
                    this.currentPhaseDisplay.textContent = text;
                }
            }
            
            getRandomPhrase(phrases) {
                return phrases[Math.floor(Math.random() * phrases.length)];
            }
            
            speak(text) {
                if (!window.speechSynthesis || !this.isActive) return;
                
                // Cancel any ongoing speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.volume = this.volume;
                utterance.rate = 0.8; // Slightly slower for contemplative pace
                utterance.pitch = 1.0;
                
                // Try to use selected voice
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    switch (this.selectedVoice) {
                        case 'google_female':
                            utterance.voice = voices.find(v => v.name.includes('Google') && v.name.includes('Female')) || voices[0];
                            break;
                        case 'google_male':
                            utterance.voice = voices.find(v => v.name.includes('Google') && v.name.includes('Male')) || voices[0];
                            break;
                        case 'whisper':
                            utterance.volume = this.volume * 0.6;
                            utterance.rate = 0.6;
                            break;
                        default:
                            // Use default system voice
                            break;
                    }
                }
                
                window.speechSynthesis.speak(utterance);
            }
        }
        
        // Initialize Voice Guidance System
        let sacredVoiceGuide;
        
        // Wait for voices to load
        if (window.speechSynthesis) {
            window.speechSynthesis.onvoiceschanged = () => {
                if (!sacredVoiceGuide) {
                    sacredVoiceGuide = new SacredVoiceGuide();
                }
            };
            
            // Fallback if voices are already loaded
            setTimeout(() => {
                if (!sacredVoiceGuide) {
                    sacredVoiceGuide = new SacredVoiceGuide();
                }
            }, 1000);
        }
        
    </script>
</body>
</html>