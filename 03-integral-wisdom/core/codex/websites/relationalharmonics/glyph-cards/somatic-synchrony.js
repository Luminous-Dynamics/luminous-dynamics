// Œ©16: Somatic Synchrony - Living Glyph Card
// Bodies breathing as one, hearts beating in rhythm

const somaticSynchronyData = {
    id: 'Œ©16',
    name: 'Somatic Synchrony',
    symbol: 'ü´±üèΩ‚Äçü´≤üèæ',
    type: 'foundational',
    category: 'embodied-connection',
    subcategory: 'somatic-practices',
    primaryHarmony: 'universal-interconnectedness',
    supportingHarmonies: ['resonant-coherence', 'pan-sentient-flourishing'],
    
    description: 'The sacred practice of bodies finding shared rhythm. When we synchronize breath, heartbeat, and movement, we create a field of embodied unity that transcends words.',
    
    purpose: 'To create deep somatic connection through synchronized breath, movement, and presence, allowing bodies to communicate in their ancient language.',
    
    coreElements: {
        breathSynchrony: 'Matching respiratory rhythms',
        heartCoherence: 'Aligning cardiac patterns',
        movementMirroring: 'Reflecting physical presence',
        nervousSystemRegulation: 'Co-regulating together',
        energeticResonance: 'Sharing life force'
    },
    
    practices: {
        basic: {
            duration: '5-10 minutes',
            description: 'Simple breath and heartbeat synchronization',
            steps: [
                'Sit facing your partner, close enough to sense their energy',
                'Begin by noticing your own breath naturally',
                'Gradually tune into your partner\'s breathing rhythm',
                'Allow your breaths to naturally synchronize',
                'Place hand on heart, feeling the pulse of life',
                'Imagine your heartbeats finding shared rhythm',
                'Rest in this somatic unity for several minutes'
            ]
        },
        
        intermediate: {
            duration: '15-20 minutes',
            description: 'Movement mirroring and energetic attunement',
            steps: [
                'Stand facing each other, arms length apart',
                'One person begins slow, simple movements',
                'Other person mirrors like a loving reflection',
                'Switch roles fluidly without speaking',
                'Add synchronized breathing to movement',
                'Include pauses to feel energetic connection',
                'End with hands on each other\'s hearts'
            ]
        },
        
        advanced: {
            duration: '30-45 minutes',
            description: 'Full somatic journey of synchronized embodiment',
            steps: [
                'Begin lying down, heads touching crown to crown',
                'Synchronize breathing in this connected position',
                'Slowly rise together, maintaining breath sync',
                'Move into spontaneous synchronized dance',
                'Include moments of stillness and motion',
                'Practice energetic push and pull exercises',
                'Complete with extended heart-to-heart embrace'
            ]
        }
    },
    
    guidedPractice: {
        title: 'Journey into Somatic Unity',
        duration: 420, // 7 minutes
        steps: [
            {
                time: 0,
                instruction: 'Find comfortable position facing your partner',
                duration: 30
            },
            {
                time: 30,
                instruction: 'Close eyes and tune into your own breath, your own heartbeat',
                duration: 30
            },
            {
                time: 60,
                instruction: 'Open eyes softly, meeting your partner\'s gaze with gentleness',
                duration: 20
            },
            {
                time: 80,
                instruction: 'Begin to notice your partner\'s breathing rhythm',
                duration: 40
            },
            {
                time: 120,
                instruction: 'Allow your breath to gradually match theirs, finding shared rhythm',
                duration: 60
            },
            {
                time: 180,
                instruction: 'Place right hand on your heart, left hand reaching toward partner',
                duration: 30
            },
            {
                time: 210,
                instruction: 'Feel or imagine your heartbeats synchronizing',
                duration: 60
            },
            {
                time: 270,
                instruction: 'Begin gentle swaying or rocking together',
                duration: 60
            },
            {
                time: 330,
                instruction: 'Pause in stillness, feeling the unified field between you',
                duration: 60
            },
            {
                time: 390,
                instruction: 'Gently bow to each other, honoring this somatic connection',
                duration: 30
            }
        ]
    },
    
    variations: {
        solo: 'Synchronize with your own heartbeat and breath, creating internal resonant-coherence',
        group: 'Circle breathing and movement, creating collective somatic field',
        nature: 'Synchronize with natural rhythms - waves, wind, bird songs',
        distance: 'Practice synchrony while physically apart, connected in consciousness'
    },
    
    integration: {
        withWork: 'Brief synchrony moments before important conversations',
        withFamily: 'Family breathing circles for nervous system co-regulation',
        withStrangers: 'Subtle breath matching to create rapport and safety',
        withSelf: 'Morning synchrony with your own body rhythms'
    },
    
    indicators: {
        mastery: [
            'Natural breath synchronization without effort',
            'Sensing partner\'s state through somatic cues',
            'Ability to co-regulate distressed nervous systems',
            'Creating coherent field through presence alone',
            'Movement synchrony arising spontaneously'
        ],
        
        resistance: [
            'Discomfort with physical proximity',
            'Unable to slow down enough to sense',
            'Mind wandering away from body',
            'Forcing synchrony rather than allowing',
            'Fear of somatic intimacy'
        ],
        
        integration: [
            'Increased body awareness throughout day',
            'Natural mirroring in conversations',
            'Calming presence for others',
            'Intuitive movement responses',
            'Embodied empathy deepening'
        ]
    },
    
    scientificBasis: {
        interpersonalNeurobiology: 'Mirror neurons facilitate somatic universal-interconnectedness',
        heartRateVariability: 'Cardiac synchrony measurably increases with practice',
        nervousSystemTheory: 'Co-regulation promotes mutual healing',
        breathworkResearch: 'Synchronized breathing alters consciousness',
        movementTherapy: 'Mirroring creates neurological bonding'
    },
    
    traditionalRoots: {
        sufi: 'Whirling in unified movement fields',
        african: 'Drumming and dance synchronization rituals',
        indigenous: 'Breath sharing ceremonies',
        vedic: 'Pranayama partner practices',
        shamanic: 'Entrainment with cosmic rhythms'
    },
    
    groupApplication: {
        size: '2-20 people',
        formation: 'Pairs, triads, or circles',
        space: 'Room for gentle movement',
        materials: 'Optional: soft music with clear rhythm',
        guidance: 'Gentle facilitation supporting natural synchrony'
    },
    
    sacredGeometry: {
        pattern: 'Vesica Piscis - two circles overlapping',
        rhythm: '4-7-8 breath pattern for synchronization',
        movement: 'Figure-8 infinity patterns',
        energetic: 'Toroidal field between bodies'
    },
    
    prerequisites: [
        'Œ©8: Inner Resonant Resonant Coherence',
        'Œ©13: Conscious Touch',
        'Œ©5: Coherent Field Maintenance'
    ],
    
    nextPractices: [
        'Œ©35: Energy Circulation',
        '‚àë2: Somatic Resonant Resonant Coherence Cascade',
        'Advanced movement practices'
    ],
    
    music: {
        suggested: 'Rhythmic ambient, binaural beats at 7.83 Hz, heart drums',
        avoid: 'Complex melodies, lyrics, jarring transitions',
        silence: 'Often most powerful for deep synchrony'
    },
    
    season: 'Spring - season of renewal and shared growth',
    moon: 'Waxing moon - building connection',
    time: 'Dawn or dusk - liminal synchronization times',
    
    mantra: 'We breathe as one, we move as one, we are one',
    mudra: 'Palms together, pulsing with heartbeat',
    
    breathPattern: {
        inhale: 4,
        hold: 4,
        exhale: 4,
        pause: 4,
        note: 'Square breath for stability and synchronization'
    },
    
    cautionNotes: [
        'Respect physical boundaries always',
        'Allow natural rhythms without forcing',
        'Stop if dizziness occurs from breath work',
        'Honor each person\'s comfort with proximity',
        'Not recommended during acute illness'
    ],
    
    facilitatorNotes: {
        preparation: 'Practice your own somatic awareness first',
        holding: 'Create safe container for vulnerability',
        guidance: 'Minimal verbal cues, maximum presence',
        completion: 'Gentle transition back to individual rhythms',
        integration: 'Time for sharing somatic experiences'
    },
    
    journalPrompts: [
        'What did I discover in shared rhythm?',
        'Where did I resist synchronization?',
        'How did unity feel in my body?',
        'What arose in the space between us?',
        'How can I carry this connection forward?'
    ]
};

// Class implementation
class SomaticSynchronyCard extends LivingGlyphCard {
    constructor() {
        super(somaticSynchronyData);
        this.syncInterval = null;
        this.breathPhase = 'inhale';
        this.partnerConnected = false;
    }
    
    initializePractice() {
        super.initializePractice();
        this.startBreathingGuide();
        this.initializeSynchronyTracking();
    }
    
    startBreathingGuide() {
        const breathPattern = this.data.breathPattern;
        let phase = 0;
        
        this.syncInterval = setInterval(() => {
            const phases = ['inhale', 'hold', 'exhale', 'pause'];
            this.breathPhase = phases[phase];
            
            this.updateBreathDisplay(this.breathPhase);
            
            // Emit breath phase for partner synchronization
            this.emitBreathPhase(this.breathPhase);
            
            phase = (phase + 1) % 4;
        }, 4000); // 4 seconds per phase
    }
    
    updateBreathDisplay(phase) {
        const display = this.querySelector('.breath-guide');
        if (display) {
            const symbols = {
                inhale: 'ü´Å ‚Üë',
                hold: 'ü´Å ‚è∏',
                exhale: 'ü´Å ‚Üì',
                pause: 'ü´Å ‚è∏'
            };
            display.textContent = symbols[phase];
            display.className = `breath-guide ${phase}`;
        }
    }
    
    initializeSynchronyTracking() {
        // In real implementation, would connect to partner's practice
        // For now, simulate synchrony detection
        
        this.addEventListener('breath-phase', (e) => {
            if (e.detail.partnerId && e.detail.phase === this.breathPhase) {
                this.recordSynchronyMoment();
            }
        });
    }
    
    recordSynchronyMoment() {
        const indicator = this.querySelector('.synchrony-indicator');
        if (indicator) {
            indicator.classList.add('synchronized');
            setTimeout(() => {
                indicator.classList.remove('synchronized');
            }, 2000);
        }
        
        // Track synchrony score
        this.synchronyScore = (this.synchronyScore || 0) + 1;
        this.updateSynchronyDisplay();
    }
    
    updateSynchronyDisplay() {
        const display = this.querySelector('.synchrony-score');
        if (display) {
            const percentage = Math.min(100, this.synchronyScore * 5);
            display.textContent = `Synchrony: ${percentage}%`;
            display.style.color = `hsl(${percentage * 1.2}, 70%, 50%)`;
        }
    }
    
    completePractice() {
        clearInterval(this.syncInterval);
        
        const results = {
            duration: this.getPracticeDuration(),
            synchronyScore: this.synchronyScore || 0,
            breathPhases: this.breathPhaseCount || 0,
            heartCoherence: this.measureCoherence()
        };
        
        this.saveResults(results);
        super.completePractice();
    }
    
    measureCoherence() {
        // In real implementation, would use HRV sensors
        // Simulate based on practice quality
        return 75 + Math.random() * 25;
    }
    
    render() {
        return `
            ${super.render()}
            <div class="somatic-synchrony-features">
                <div class="breath-guide">ü´Å</div>
                <div class="synchrony-indicator">
                    <div class="pulse-ring"></div>
                    <div class="pulse-ring delayed"></div>
                </div>
                <div class="synchrony-score">Synchrony: 0%</div>
                <button class="partner-connect">Connect with Partner</button>
            </div>
            <style>
                .somatic-synchrony-features {
                    text-align: center;
                    margin: 2rem 0;
                }
                
                .breath-guide {
                    font-size: 3rem;
                    margin: 1rem 0;
                    transition: all 1s ease;
                }
                
                .breath-guide.inhale {
                    transform: scale(1.2);
                    color: #4a90e2;
                }
                
                .breath-guide.hold {
                    color: #7b68ee;
                }
                
                .breath-guide.exhale {
                    transform: scale(0.8);
                    color: #50c878;
                }
                
                .breath-guide.pause {
                    color: #ff6b6b;
                }
                
                .synchrony-indicator {
                    position: relative;
                    width: 100px;
                    height: 100px;
                    margin: 2rem auto;
                }
                
                .pulse-ring {
                    position: absolute;
                    inset: 0;
                    border: 3px solid rgba(255, 0, 100, 0.5);
                    border-radius: 50%;
                    animation: pulse 4s ease-in-out infinite;
                }
                
                .pulse-ring.delayed {
                    animation-delay: 0.5s;
                    border-color: rgba(0, 100, 255, 0.5);
                }
                
                .synchrony-indicator.synchronized .pulse-ring {
                    border-color: rgba(255, 215, 0, 0.8);
                    animation-duration: 2s;
                }
                
                @keyframes pulse {
                    0%, 100% {
                        transform: scale(0.8);
                        opacity: 0.8;
                    }
                    50% {
                        transform: scale(1.2);
                        opacity: 0.3;
                    }
                }
                
                .synchrony-score {
                    font-size: 1.2rem;
                    font-weight: bold;
                    margin: 1rem 0;
                    transition: color 0.5s ease;
                }
                
                .partner-connect {
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    border: none;
                    padding: 0.75rem 1.5rem;
                    border-radius: 25px;
                    cursor: pointer;
                    transition: transform 0.3s ease;
                }
                
                .partner-connect:hover {
                    transform: translateY(-2px);
                }
            </style>
        `;
    }
}

// Register the card
customElements.define('somatic-synchrony-card', SomaticSynchronyCard);

// Export for use
export { SomaticSynchronyCard, somaticSynchronyData };